---
title: "Assessment of forestry road network projection methods using the “roads” package in R"
author:
  - name: Josie Hughes
    email: josie.hughes@ec.gc.ca
    institute: [ECCC]
    correspondence: true
  - name: Sarah Endicott
    email: sarah.endicott@ec.gc.ca
    institute: [ECCC]
    correspondence: false
institute:
  - ECCC: Environment and Climate Change Canada 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      # pandoc_args:
      # - --lua-filter=../templates/scholarly-metadata.lua
      # - --lua-filter=../templates/author-info-blocks.lua
      # - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-forest-ecology-and-management.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
editor_options: 
  chunk_output_type: console
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300,
  cache = TRUE
)
```

<!-- The actual document text starts here: -->

# Introduction

Global biodiversity is being lost at an unprecedented rate as a result of human activities. One of the major world-wide threats to biodiversity is increasing infrastructural development (Benítez-López et al., 2010). Land transformation has resulted in the loss and fragmentation of habitats in many different ecosystem types worldwide (Benítez-López et al., 2010; Sanderson et al., 2002). Roads and other linear infrastructure, in particular, are key components of landscapes as they have become a major cause of habitat loss, fragmentation, and degradation and are ubiquitous in most landscapes around the world (van der Ree et al., 2011). Although linear infrastructure is important for society because it provides connectivity for people, it also exerts significant negative effects on adjacent habitats, wildlife populations, communities, and ecosystems (van der Ree et al., 2011).

Resource extraction, such as forest harvesting, is the main driver of road construction in much of Canada's forested area. In British Columbia, over 600 000 kilometers of resource roads make up the vast majority of the province's total road network (83%) (Environmental Reporting BC, 2018; Forest Practices Board, 2015). Over 75% of resource roads in the province were built by the forest industry (Forest Practices Board, 2015). Resource extraction activities provide jobs and renewable raw materials (Canada, 2013b), but they also can create threats for wildlife. For example, the main threats to woodland caribou, a species at risk in Canada, are human disturbances such as forest harvesting, oil and gas exploration/extraction, and road networks. These particular disturbances fragment their habitat, and create open areas and extensive young forests that attract other species such as moose and deer which in turn, attracts an increased number of predators, such as wolves and even poachers (Canada, 2013a). Woodland caribou are often considered to be an umbrella species, which means that protecting and restoring their habitat would benefit other species also dependent on old forests, such as fishers, pine martens, and many species of birds (Mulvihill, 2018).

With certain wildlife, such as woodland caribou, being highly sensitive to road development and use, there is a need to spatially simulate future roads in order to test the implications of alternative recovery policies and resource development scenarios. Landscape models are mathematical simulations designed to represent at least one landscape pattern-process relationship of interest. Landscape models can be great ways to make predictions about specific scenarios that allow ecologists and land managers to assess alternative management scenarios or to assess the potential impact of anthropogenic change scenarios (climate or land use change) (McGarigal, n.d.). Simulating the effects of disturbances, such as forestry road development, helps to broaden the scope of models, especially for species with complex ecological requirements who reside in disturbance-prone landscapes that undergo dynamic changes which may substantially alter habitat quality (Whitman et al., 2017). Land managers are often responsible for multiple species and populations distributed over large regions and often rely on models to determine habitat suitability (Whitman et al., 2017).

Forest simulation models generally either fall into two categories: deterministic and stochastic (Boychuk et al., 2009; Helmes & Stockbridge, 2011). Stochastic simulation approaches use probability distributions in combination with random number generators to determine events (He & Mladenoff, 1999). Despite the importance of roads on the environment, previous spatial stochastic harvest simulation models rarely include forest road network development in their projections. The "roads" package in R aims to fill this gap in landscape modelling by projecting large-scale forest road networks based on future harvest cut blocks, an existing road network, and a road cost surface. This paper uses the "roads" package to run forestry road network simulations in British Columbia from approximately 1990 to present and compares the results to the observed modern-day forest road networks in order to assess the performance of the package and to showcase its usefulness within forest simulations.

(Introduction round 2: road context) Several papers have previously introduced forest road network projections (Anderson & Nelson, 2004; Clark et al., 2000; Dean, 1997) however many of these methods are complex with many input parameters and are not readily available for public use. These previous projections have mainly been developed in order to facilitate operational forest road network planning and therefore require precise data and many input parameters in order to obtain the most effective network. These projection methods are therefore not very applicable for projecting forest roads over large-scale landscapes. On the other hand, many spatial stochastic forest management simulations haven't included forest road development at all (citations). One unpublished QGIS plugin by Clement (2021) is available for projecting forest roads and is also included in the analysis of this paper (GitHub - Klemet/ForestRoadNetworkPluginForQGIS: A plugin for QGIS that is able to construct a forest road network based on a cost matrix, polygons to reach, a current road network, the dijkstra algorithm and 3 network-creation heuristics.). There is therefore a need in large scale landscape simulations for a tool that can adequately project forest road development with less complexity and minimal input parameters that can easily be incorporated into other complex simulations in large scale landscapes. As many ecological forecasts use increasingly complex methods and data, forecasting tools (e.g., models) should also be scalable and leverage existing models (Bodner et al., in press) ("Bridging the divide between ecological forecasts and environmental decision-making").

The goal of our model is to provide simple, accessible, and usable forest road network projections that can easily be applied in the context of large-scale landscapes and wildlife impact simulations, and can also be applied as an element of more complex models. Our model will be openly accessible and uses minimal input parameters (an existing road network, harvest cutblocks, and cost surface) which makes it easily transferable to many forest resource dominated landscapes. Here, we evaluate its accuracy at simulating forest road development across a large landscape by recreating the network starting from approximately 1990 and comparing it to the present day observed forest road network. In order to compare the projected and observed road networks, we used various metrics that are similar to those used in wildlife impact studies to compare the projected and observed landscapes both spatially and aspatially.

In the first section of the paper (methods), we introduce the study area used to assess the accuracy of the projection, we describe the forest road projection methods, the data required, and the various metrics used in order to analyze the similarities and differences between the projected and observed forest road networks across the landscape. Next, we present and discuss the results of our projections across the landscape and compare the metrics spatially and aspatially.

# Methods

## Study Area

We chose the Revelstoke timber supply area (TSA 27), in British Columbia, Canada as our study area because forestry is the dominant resource extraction activity in this region and much of the TSA's road network is composed of forestry resource roads built to gain access to forest harvest cutblocks (Figure 1). This allows us to project road building based on forest harvest data. With approximately 55% of Revelstoke TSA's area being non-forested land (alpine, lakes, swamp, brush, rock, etc) [@brown2010], the TSA also provides an ideal location to observe the behaviour of the projections across a landscape which presents multiple barriers to road development. The Revelstoke TSA is in the interior-wet belt of the province and its forests are dominated by Englemann spruce (31%), Hemlock (23%), Cedar (22%), and Douglas-fir (18%) [@ministryofforests]. The TSA contains wildlife species that are at risk due to their declining populations and are thought to be negatively affected by road development, such as members of the southern mountain woodland caribou population [@brown2010]. The Revelstoke TSA is an example of a landscape where road projections could be used to manage critical wildlife habitats. The British Columbia TSA boundary shapefile layer was downloaded from the British Columbia Data Catalogue [@governmentofbritishcolumbia2021].

```{r fig1, fig.cap="Revelstoke timber supply area in British Colombia, Canada. The colour shows the cost of building roads across each pixel."}
##### Metric table bar plots
library(ggplot2)
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
library(ggpubr)
library(MetBrewer)
library(here)
library(tmap)
library(sf)

#set paths
data_path_raw <- "analysis/data/raw_data/"
data_path_drvd <- "analysis/data/derived_data/"

pal_nm <- "Egypt"

fig_widths <- c(min = 1.18, single = 3.543, mid = 5.51, two = 7.48)

tsaBoundary <- read_sf(here(data_path_raw, "tsa27_boundaries.gpkg"))
#cost surface raster layer
bc_cost_surface <- terra::rast(here(data_path_raw, "cost_surface_bc_ha.tif"))
lakeValue <- 65000

tsaCost <- terra::crop(bc_cost_surface, tsaBoundary)
tsaCost <- terra::subst(tsaCost, from = NA, to = lakeValue)
tsaCost <- terra::mask(tsaCost, terra::vect(tsaBoundary))

canada <- geodata::gadm("CAN", level = 1, path = here(data_path_raw))

canada <- canada %>% 
  st_as_sf() %>% 
  filter(NAME_0 == "Canada") %>% 
  st_transform(st_crs(tsaBoundary)) %>% 
  st_simplify(dTolerance = 10000)

canada_overlay <- tm_shape(canada, projection = "+proj=lcc +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs")+
  tm_borders(col="black")+
  tm_shape(st_buffer(tsaBoundary, 10000))+
  tm_polygons(border.col = met.brewer(pal_nm, 1), col = met.brewer(pal_nm, 1))+
  tm_layout(frame=TRUE)

tsa <- tm_shape(tsaCost, name = "Cost")+
  tm_raster(style = "cont", title = "Cost")+
  tm_shape(st_union(tsaBoundary))+
  tm_borders(col = "black")+
  tm_compass(position = c(0.3, 0.11), size = 1)+
  tm_scale_bar(position = c("center", "bottom"), text.size = 1)+
  tm_layout(legend.position = c("left", "bottom"),
            legend.bg.color = "white")
  

vp <- grid::viewport(x=0.965, y=0.945, width = 0.35, height=0.2,
               just=c("right", "top"))

tmap_save(tsa, filename = here("analysis/figures/Figure1_StudyArea.png"),
  dpi = 600, insets_tm = canada_overlay, insets_vp = vp,
  height = 6, width = fig_widths["single"], units = "in")

knitr::include_graphics(here("analysis/figures/Figure1_StudyArea.png"))

```

## Data

To spatially define the cost of constructing and traveling on a forestry road we developed a cost surface raster. We used several spatial raster layers to construct our cost surface. For all cells the base cost followed the Interior Appraisal Manual of BC where the cost per kilometer of road was a linear function of slope [@governmentofbritishcolumbia2021a]. Separate costs for river and pipeline crossings were then added to the cost. Major water bodies were considered barriers and assigned a very high cost. Lastly, to coerce the algorithm to follow existing roads, all nodes representing the existing road network were assigned a cost of 0 (Table 1). The cost surface for the Revelstoke TSA consisted of 1703936 pixels with a resolution of 100 meters by 100 meters.

Table 1. Definitions of road building costs for building the cost surface.

```{r}
tbl <- "Cost Type|Road Attribute|Value ($ per km)|Source
Barriers of road development|Major lakes|65000|Major water bodies of BC
Impedance|Existing roads|0|Assumed
Road Construction Cost Structure|Pipe crossing|1911|Interior Appraisal Manual
|River crossing|2130|Interior Appraisal Manual
|Base cost|16178 + 504*slope|Interior Appraisal Manual
"
df <- read.delim(textConnection(tbl),header=FALSE,sep="|",strip.white=TRUE,stringsAsFactors=FALSE)
names(df) <- unname(as.list(df[1,]))
df <- df[-1,] # remove first row
row.names(df)<-NULL
knitr::kable(df)
```

Our road network data was obtained by combining the digital road atlas (DRA) [@databc2021] and forest tenure road [@britishcolumbiaministryofforestslandsnaturalresourceoperationsandruraldevelopmentflnrord2021] data sets for BC. To avoid situations where the same road was included in both data sets with slightly different coordinates we removed all roads from the DRA data set that were within 50m of a road in the forest tenure road data set. The existing road network, used as the starting point for projections, was created by filtering out forest tenure roads with an award date greater than 1990. Cutblock information was obtained from the Harvest Areas of BC (Consolidated Cutblocks) dataset [@governmentofbritishcolumbia2021b]. Cutblock information is compiled from provincial Forest Cover, the RESULTS Reporting system, Forest Tenure applications, and satellite imagery using change detection processes. The dataset does not exclude non-harvested 'reserved' areas, and satellite image change detection may not always represent the entire cutblock area [@governmentofbritishcolumbia2021b]. Forest harvest cutblocks with harvest years greater than 1990 were filtered and used as targets for the projections.

## Road Projection Methods

We developed the `roads` R package to project where new roads will be built based on the existing road network, locations of expected resource extraction (i.e. harvest cutblocks) and the landscape connecting the two. There are several different methods available for solving this problem, including snapping, least cost paths, and minimum spanning trees. Snapping follows a straight line between the existing road and each cutblock regardless of the intervening landscape. The least cost paths (LCP) method uses Dijkstra's shortest path algorithm [-@dijkstra1959] to determine the optimal path between a cutblock and the existing road based on the cost of building a road at any point between the two. The path to each cutblock is determined independently of the other cutblocks. The cost is represented by a cost raster described below. Finally, the minimum spanning tree (MST) method builds on the LCP method by determining the least cost path between all cutblocks and the road and between each cutblock. Then the minimum spanning tree connecting all cutblocks to the road is solved using Kruskal's algorithm [-@kruskal1956]. (See Appendix X for a more detailed explanation of these methods). In the remainder of this paper, we focus on the LCP and MST approaches given their assumptions are better aligned with how road networks are designed.

In addition to the projection methods included in the `roads` package we also applied the Forest Road Network Plugin for QGIS by Clément Hardy (<https://github.com/Klemet/ForestRoadNetworkPluginForQGIS>). This plugin uses a similar least cost path algorithm to the `roads` package but instead of building roads along the least cost path to each cutblock independently the Forest Road Network Plugin uses a heuristic to determine which cutblocks to connect first and then builds the roads sequentially. The default heuristic is to connect the closest cutblocks first. We supplied our cost surface, cutblocks and road network data and kept all the default settings within the QGIS plugin.

## Analysis

We projected road development in the Revelstoke TSA from 1990 to the present using several different inputs and compared the projections to the observed present day road network in order to evaluate the accuracy of the projections and their sensitivity to different inputs. We compared two resolutions for the cost surface by aggregating the fine resolution cost raster to a coarser 1000 m resolution. We also compared methods for locating landing points within cutblocks by comparing using the polygon centroid, regularly spaced and random points, as well as point densities of 1 and 100 pts/km^2^ (Figure \@ref(fig:fig2)). Note that the default skidding distance used by the Hardy QGIS plugin is 100 m which corresponds to 25 pts/km^2^ .

```{r fig2, fig.height=5, fig.width=fig_widths["two"], fig.cap="Example of the different projection methods and sampling strategies."}
knitr::include_graphics(here("analysis/figures/projection methods figure.jpg"))
```

In order to assess the performance of the projections, the following metrics were used to compare the projected forest road network results with the observed network: 1) Road presence, a simple measure of whether or not roads are present in each pixel; 2) Road disturbance footprint, 1 km buffer applied to observed and projected roads [@ibisch2016a]; 3) Forestry disturbance footprint, a 500 m buffer applied to observed and projected roads and cutblocks; 4) Road density, density of roads in meters per hectare (m/ha); 5) Distance to nearest road, distance from each raster cell to the nearest road. The forestry disturbance footprint follows the anthropogenic disturbance metric used for boreal caribou [@johnson2020], and was calculated using the `caribouMetrics` R package [@hughes]. Road density is an important metric that is often used when studying anthropogenic impacts on wildlife (Beazley et al., 2004). Road density was calculated using the rasterizeLineDensity function within the `caribouMetrics` package. Distance to nearest road was calculated using a fast moving window method in the `getDistFromSource` function of the roads package. Each metric was applied to the results from each projection method and the observed roads with the results were stored as rasters.

The aspatial accuracy of the projections was assessed by calculating the mean values of the projection metric rasters and then comparing them with the means of the observed metric rasters. This was done across the TSA and at the cutblock level, where metric rasters were masked by the cutblock polygons and the means were taken only from within cutblocks.

The projections were assessed for their spatial accuracy in two different ways. First, difference maps were created by subtracting the road presence rasters of the projected networks with the observed network in order to highlight discrepancies between the networks. The observed and projected road network shapefiles were then overlain on the difference maps and regions of major discrepancies were investigated using Google satellite imagery in QGIS to investigate potential causes of the discrepancy. Secondly, a matching analysis using the three binary metrics (road presence, road disturbance footprint, and forestry disturbance footprint) was performed. This matching analysis compared the three metric rasters for all projection methods with the observed metric rasters and calculated percentages of the TSA that matched and didn't match. All pixels in the Revelstoke TSA for the projected networks fell into 5 categories when compared with the observed raster: 1) pre-existing roads; 2) agree roadless, both projected and observed show no roads; 3) agree roaded, both projected and observed show new roads; 4) false positive, the projection showed a road but no roads were observed; and 5) false negative, the projection showed no roads but a road was observed. Using these 5 categories, the landscape within the Revelstoke TSA was categorized for each projection method and summarized. We used the performance metrics sensitivity, precision and F-measure to compare the results for each projection method [@lee2021].

# Results

## Aspatial accuracy

Projection accuracy varied widely across the 5 metrics and two scales compared (Figure \@ref(fig:fig3)). Across all projection methods road projections were less accurate within cutblocks than in the whole TSA. Metrics that used a buffer around the roads, forestry and road disturbance footprint, showed closer agreement between the observed and projected roads than the road density and road presence metrics at both scales. For all methods the distance to road metric was underestimated within cutblocks but was similar to the observed across the whole TSA. The road presence and road density metrics were the most sensitive to pixel size and were less accurate when the coarse cost raster was used (reference appendix table for coarse resolution projections).

When comparing between projection methods we found that the density of landing points chosen within cutblocks made a large difference to the results with the high density method overestimating the road density and road presence metrics while the low density and centroid methods underestimated them. The sampling method for choosing points in the cutblocks, either random or regular, did not have a large effect on the results for the low sample density but regular sampling was less accurate for all metrics with the high sample density. Hardy's QGIS plugin performed well at the overall scale but tended to overestimate the amount of roads within cutblocks.

```{r get-data}
# load csv
meanTable <- read.csv(here(data_path_drvd, "mean_table.csv"))

matchData <- read.csv(here(data_path_drvd, "agree_table.csv"))

```

```{r fig3, fig.height=3.3, fig.width=fig_widths["single"], fig.cap="Proportional difference of projected mean from observed mean road metrics using different projection methods across the entire Revelstoke TSA (“overall”) and within cutblocks (“cutblocks”). Values greater than 0 indicate the projection overestimated the amount of roads and negative values indicate an underestimation."}
# organize data for ggplot
meanTable_long <- meanTable %>%
  pivot_longer(-c(sampleType, sampleDens, areaMean),
               names_to = "metric", values_to = "response")%>%
  mutate(sampleType = ifelse(sampleType == sampleDens, NA_character_, 
                             sampleType),
         sampleDens = paste(sampleType, sampleDens) %>% 
           factor(levels = c("NA centroid",
                             "NA observed",
                             "random low sample density",
                             "regular low sample density",
                             "random high sample density",
                             "regular high sample density",
                             "NA klementQGIS"),
                  labels = c("Centroid", 
                             "Observed",
                             "Random\nlow density",
                             "Regular\nlow density",
                             "Random\nhigh density",
                             "Regular\nhigh density",
                             "Hardy QGIS")),
         metric = factor(metric,
                         levels = c("roadDensityMean", "roadPresenceMean",
                                    "distanceToRoadMean",
                                    "forestryDisturbanceMean",
                                    "roadDisturbanceMean"),
                         labels = c("Road\ndensity", "Road\npresence",
                                    "Distance\nto road",
                                    "Forestry\ndisturbance\nfootprint",
                                    "Road\ndisturbance\nfootprint")))


observed_values <- filter(meanTable_long, sampleDens == "Observed")
projected_values <- filter(meanTable_long, sampleDens != "Observed")

# get proportional difference from observed
prop_dif <- projected_values %>% 
  left_join(observed_values %>% select(areaMean, metric, response),
            by = c("areaMean", "metric"), 
            suffix = c("_proj", "_obs")) %>% 
  mutate(prop_dif = (response_proj-response_obs)/response_obs,
         areaMean = factor(areaMean, labels = c("Cutblocks", "Overall")))

prop_dif %>% 
  ggplot(aes(x = sampleDens, prop_dif, fill = sampleDens))+
  geom_hline(aes(yintercept = 0), color = "grey")+
  geom_col(position = position_dodge2(preserve = "single",
                                      width = 0.75))+
  facet_grid(areaMean~ metric)+
  theme_classic()+
  scale_fill_manual(values = met.brewer(pal_nm, 8) %>% .[c(8, 1:4, 6)],
                    name = "Sampling\nMethod", guide = "none")+
  theme(text = element_text(size = 10), axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "right",
        axis.text.x=element_text(size=11, angle=50, vjust=1, hjust=1))+
  coord_flip()

# Create bar plot This is the old version keep in case
fig3 <- projected_values %>% group_by(areaMean) %>% nest() %>% ungroup() %>%
  mutate(obs = observed_values %>% group_by(areaMean) %>% nest() %>% pull(data)) %>%
  group_by(areaMean) %>%
  mutate(data = map(data, ~mutate(.x, area = areaMean)),
         plot = map2(data, obs,
                    ~ ggplot(.x, aes(x = sampleDens, response, fill = sampleType))+
                      geom_col(position = position_dodge2(preserve = "single",
                                                         width = 0.75))+
                      geom_hline(aes(yintercept = response),
                                 .y, color = "black", linetype = "dashed")+
                      facet_wrap(~metric, scales = "free_y", ncol = 1)+
                      theme_classic()+
                      scale_fill_manual(values = met.brewer(pal_nm, 4))+
                      theme(text = element_text(size = 15), axis.title.x = element_blank(),
                            axis.title.y = element_blank(),
                            legend.position = "none")+
                      ggtitle(str_to_title(areaMean)))) %>%
  pull(plot) %>%
  {ggarrange(plotlist = .)}


```

## Spatial accuracy

Difference maps helped to highlight areas of discrepancy between the projections and the observed forestry road networks. In areas where the quality of the cutblock and road data was high, the projections remained within a reasonable vicinity of the observed roads and also realistically remained within valley bottoms without cutting across natural barriers such as mountains (figure 4a). Areas of greatest discrepancy often suggest problems with available forestry road or cutblock data. There are some areas in Revelstoke, for example, where there are mapped cutblocks but no mapped access roads, even though satellite images clearly show roads (Figure 4b). There are also instances where areas were likely misidentified as cutblocks (Figure 4c). This is likely due to difficulty distinguishing cutblocks from other unforested areas such as scree slopes and meadows using remote sensing methods.

```{r fig4, fig.height=9, fig.width=fig_widths["two"], fig.cap="Difference maps used to investigate the performance of the projections. Image “a” shows an area of low discrepancy where the projections matched well. When zooming in on the discrepancy shown in image “b”, one can see from the satellite imagery that there are forest roads in the imagery that are missing from the observed data. Image “c” reveals one example of a cutblock that has most likely been mislabelled by remote sensing as it is located on the summit of a mountain."}

knitr::include_graphics(here("analysis/figures/Figure4_diff_map.png"))

```

```{r fig5, fig.height=9, fig.width=fig_widths["two"], fig.cap="Spatial accuracy"}

matchData_sum <- matchData %>% ungroup() %>%
  mutate(agreement = factor(agreement,
                            levels = c("False negative", "False positive",
                                       "Agree roaded","Agree roadless",
                                       "Pre-existing roads")),
         sampleDens = paste(sampleType, sampleDens) %>%
           str_replace("1e-06", "low density") %>%
           str_replace("1e-04", "high density") %>%
           str_replace("centroid high density", "centroid") %>%
           str_replace("klementQGIS NA", "klementQGIS") %>%
           factor(levels = c("centroid",
                             "random low density",
                             "random high density",
                             "regular low density",
                             "regular high density",
                             "klementQGIS"),
                  labels = c("Centroid", "Random\nlow density", "Random\nhigh density",
                             "Regular\nlow density",
                             "Regular\nhigh density",
                             "Hardy QGIS")),
         metric = factor(metric,
                         levels = c("roadPresence",
                                    "forestryDisturbance",
                                    "roadDisturbance"),
                         labels = c("Road presence",
                                    "Forestry disturbance\nfootprint",
                                    "Road disturbance footprint"))) %>%
  group_by(metric, sampleDens, agreement) %>%
  summarise(count = sum(count), .groups = "drop_last") %>%
  mutate(perc = count/sum(count)*100)

stackedBar <- matchData_sum %>%
  ggplot(aes(x = sampleDens, y =perc, fill = agreement))+
  geom_col(position = "stack", width = 0.75)+
  theme_classic()+
  theme(axis.text.x=element_text(color = "black", size=11, angle=50, vjust=1, hjust=1))+
  scale_fill_manual(values = c(met.brewer(pal_nm, 4, direction = -1)[c(1,4,3,2)],
                               "#999999"))+
  theme(text = element_text(size = 15), axis.title.x = element_blank())+
  theme(legend.position="bottom", legend.text = element_text(size = 10),
        legend.title = element_blank(),
        strip.background = element_blank())+
  labs(y = "Percent of Landscape")+
  facet_wrap(~metric)

# waffle stacked bar
# matchData_sum %>%
#   #filter(metric == "Road presence") %>%
#   ggplot(aes(values = perc*3,
#              fill = factor(agreement, levels = levels(agreement))))+
#   geom_waffle(size = 0.25, colour = "white", flip = TRUE, n_rows = 9)+
#   facet_grid(metric~ sampleDens)+
#   scale_fill_manual(values = c(met.brewer(pal_nm, 4, direction = -1)[c(1,4,3,2)],
#                                "#999999"), name = "Agreement")+
#   scale_x_discrete(name = NULL) +
#   scale_y_continuous(labels = function(x) x * 9/3,
#                      expand = c(0,0), name =  "Percent of Landscape") +
#   coord_equal()+
#   theme_minimal() +
#   theme(text = element_text(size = 10),
#         panel.grid = element_blank(),
#         axis.ticks.y = element_line(),
#         legend.position = "bottom") +
#   guides(fill=guide_legend(nrow=2))

# performance table
perf_tbl <- matchData_sum %>% 
  pivot_wider(c(metric, sampleDens), names_from = agreement, 
              values_from = count) %>% 
  mutate(sensitivity = `Agree roaded`/(`Agree roaded` + `False negative`),
         precision = `Agree roaded`/(`Agree roaded` + `False positive`),
         F_measure = (2*precision*sensitivity)/(precision+sensitivity)) %>% 
  select(metric, sampleDens, sensitivity, precision, F_measure) 

perf_tbl_rng <- perf_tbl %>% group_by(metric) %>% 
  summarise(rng_F = range(F_measure) %>% round(3) %>% paste0(collapse = " - "), .groups = "drop") %>% pull(rng_F, name = metric)

perf_tbl %>% 
  pivot_longer(c(sensitivity, precision, F_measure), names_to = "perf_meas",
               values_to = "value") %>% 
  mutate(perf_meas = factor(perf_meas,
                            labels = c("F measure", "Precision", "Sensitivity"))) %>% 
  ggplot(aes(sampleDens, value, fill = sampleDens))+
  geom_col()+
  scale_fill_manual(values = met.brewer(pal_nm, 8) %>% .[c(8, 1:4, 6)],
                    name = "Sampling\nMethod", guide = "none")+
  facet_grid(metric ~ perf_meas)+
  coord_flip()+
  ylim(0, 1)+
  theme_classic()+
  labs(y = "Performance", x = NULL)

```

As expected all the projection methods preformed worst with the road presence metric (F-Measure: `r perf_tbl_rng["Road presence"]`), while the forestry disturbance footprint performed best (F-Measure: `r perf_tbl_rng["Forestry disturbance footprint"]`) and road disturbance footprint only slightly worse (F-Measure: `r perf_tbl_rng["Road disturbance footprint"]`). For the road presence metric higher sampling densities led to somewhat higher F-measure scores caused by fewer false negatives and only slightly more false positives. For the forestry and road disturbance footprint metrics, the lower density projection methods had slightly higher F-measure scores due to fewer false positives and only slightly more false negatives.

# Discussion

Through assessing the performance of our model by comparing its spatial and aspatial accuracy with the observed forest road network following 1990, we are satisfied that the projections provide adequate results given their intended use, and that it is a useful tool for projecting forest road networks across a large landscape with minimal input parameters. However, for applications where the exact location of roads is important (like operational road engineering purposes), or for projecting impacts on wildlife that respond to roads at a very fine spatial scale then this is not an appropriate model. The model does, however, have potential to be a useful tool for predicting impacts on wildlife across large landscape simulations and could easily be incorporated as an element into more complex models that take into account other landscape phenomena such as wildfires, climate change, etc. Because this model does not take timescales into account, it could be a useful post-processing tool as an element of more complex models as it can be applied retroactively to landscape simulations.

Many of the major discrepancies between the projections and the observed network had to do with potential issues with the available data. Often major discrepancies were related to cutblocks that were likely incorrectly labelled (most often through LANDSAT change detection) in places where there weren't actually cutblocks. These discrepancies had a negative influence on the overall spatial and aspatial accuracy of the projections. In order to get more accurate road projections, one could simply remove the cutblocks derived from LANDSAT as these were often the cutblocks which caused issues, however, these cutblocks were left in as a major goal of this assessment was to create road projections while adjusting input parameters as little as possible. Considering how this model will be used to simulate forest roads moving into the future, it is unlikely that potential future cutblocks will be mislabelled as they were in our situation and this would not be an issue. Another potential issue was with roads not being included in the data set that were seen in the satellite imagery. This issue relates to results from the study by Poley et al (in review) that demonstrated how road network datasets are almost universally incomplete and that many low-use roads (such as forest resource roads) can be seen within recent satellite imagery but are not included in any readily available road datasets. Mapping of roads is often especially lacking in more rural, forested, and mountainous regions where roads are often unpaved (Prendes et al., 2017) with the Auditor General of British Columbia (2017) suggesting that 100 000 km of resource roads are missing from publicly-available road network maps (inspired by Adam Ford's doc). This means there were areas where the projections built a road, causing a discrepancy, but in reality there was actually an observed road there as seen in the satellite imagery. These discrepancies also negatively impacted the spatial and aspatial accuracy results when they shouldn't have and should be treated with caution. It is possible that some roads seen in the satellite images have since been closed which could be a reason for them being absent in the roads data sets. Again, this would not present an issue when predicting future impacts on landscapes, only when assessing the model accuracy in this context. Having said this, the projections were deemed most accurate in areas where the quality of the cutblock and road data was high and consistent with what was seen in recent satellite images.

Although this model works well in an area like Revelstoke where the road network is located in a region dominated by forestry roads, it does not work well in landscapes where roads are developed based on other targets outside of cutblocks (where the intent to build the road is not to achieve the least cost path; aka seismic lines). Fort Nelson TSA (TSA 8), for example, contains a large amount of non-forestry roads which are related to seismic lines, oil and gas extraction, etc. Because of this, forestry roads make up a much smaller percentage of the overall road network. In landscapes like this, it does not make sense to use the forestry road projections as many roads are influenced by many different factors. The model was attempted in the Fort Nelson TSA however the resulting road network (Figure A-1) did not accurately portray the observed network like it did in the Revelstoke TSA. However, other resource extraction activities could likely be incorporated into this model relatively easily. The same concept could be used where mining or oil locations could be used as target locations instead of cutblock areas.

It is also worth noting that although the model can project road networks fairly accurately across a large landscape, it may differ from the way in which roads are planned in real life. The model will simply build the roads in the least costly locations based on the cost surface, however often in the real world, roads must be planned around ownership and administrative boundaries. In BC, forestry roads are developed by forest licensees under a timber harvesting permit (Government of British Columbia, 2021c).

Certain projection methods were more accurate at projected some metrics compared to others. Similarly, certain metrics were sensitive to pixel size (road density, road presence) and others were not. Depending on what the goal of running the projections is, then the projection method and resolution may or may not play an important role. If you would like to predict road density as accurately as possible, then running the projections using as fine a resolution of cost surface as possible is the best option. If you're wanting to only predict roughly the location of the roads/save computing time and are more interested in a larger area, then a coarse resolution may suit these requirements perfectly fine. The tradeoffs of using a coarser resolution of cost surface may be less extreme when projecting roads across a flatter landscape compared to a mountainous landscape like was used for this paper since there would likely be less variability in cost across larger areas.

With caribou being one of the key considerations when managing some forestry areas (like in British Columbia TSAs, including Revelstoke TSA) (Government of British Columbia, 2021), the accuracy at which "roads" can project this forestry disturbance footprint metric could allow for this package to be a truly beneficial tool for assessing the impacts towards at-risk caribou populations when looking at various forest harvest scenarios. Because caribou are also considered an umbrella species within forests (Drever et al., 2019), projecting forestry impacts on their habitats may also provide valuable insight towards other key species as well. With the input of future cutblocks and the projections of forest road networks to these cutblocks, the results from the projection can provide a great outlook at the impacts of forestry scenarios on woodland caribou habitats using the forestry disturbance footprint metric. The distance to nearest road metric appears to be a very interesting metric to consider as well when looking specifically at larger areas. Using this metric to make projections at larger scales, such as at a TSA level, may provide very beneficial information about forestry impacts especially in a wildlife context when assessing the influence of forestry on various species with different tolerances to disturbance.

Further improvements could be made that would increase the accuracy of the model. The cost surface used for this paper was developed at a provincial scale, however, a higher resolution cost surface with more detail could further improve the accuracy of the projection results. A finer resolution cost surface with more detail will ultimately create a more realistic road network and would possibly allow for more accuracy within cutblocks (where fine micro-topography, water tables, etc. will play a role in road development). The downside being that it would also increase computing time and may not always be necessary depending on the application of the model, especially when using the model for a large-scale landscape. Adding too much complexity to the cost surface may also take away from the goal of this model to be simple and easy to use, however, the algorithm itself would work on a very fine and detailed cost surface. Along with increased computing time, a key limitation of using this model on a finer cost surface would be that eventually cost pixels would need to have directionality associated with them, which is something this model does not take into account. The accuracy of comparing the projections to the observed network could also simply be improved by using higher quality/more up to date road and cutblock data.

Assessing the performance of this model also presented some unique challenges with comparing two networks with each other across a landscape. We needed to carefully think about what we were trying to achieve. The goal wasn't to present a model that matched the observed road network pixel by pixel, but instead was to simulate disturbance across a large-scale landscape to an acceptable level while still being a relatively simple and straightforward tool. It's for this reason why metrics were chosen that are commonly used in road impact assessments on wildlife; such as the road density and forestry disturbance footprint metrics. Once the vector networks were converted into these raster layers, it also facilitated comparing observed versus projected as we could compare the means across the TSA and study where pixels matched and didn't match. Incorporating these metrics into landscape level simulations is also a realistic goal for this tool (ie projecting forest road density across a landscape) so a goal was to therefore see how well the model did at simulating these metrics when compared to the observed landscape.

Many spatial stochastic models don't include road projections at all in their simulations (Bergeron et al., 2017; DeLong & Tanner, 1996; Naderializadeh & Crowe, 2020; Perera & Cui, 2010). Our model could be relatively easily incorporated, or applied retroactively, to similar spatial stochastic simulations such as these. For large-scale projects such as the Western Boreal Initiative (Environment Canada, date?) that simulate many complex factors across a landscape, our forest road projection methods could be incorporated as one element within the overall landscape simulations.

-The road presence metric is sensitive to small differences in road location while the road density metric is sensitive to variations in the curves of tightly packed roads within grid cells that cannot be modeled using this algorithm.

# Conclusion

The forest road network projection model presented here provides an effective way to project forest road networks that are suitable for large scale landscape simulations with relatively little effort. This model, however, is not suitable for strategic planning. The results from our projections in our study area overall matched up adequately with the observed present day forest road networks, with major discrepancies being attributed to issues in the available road and cutblock data. These discrepancies would not be issues in future landscape simulations, only when assessing accuracy. In areas where the quality of the data was high, projections matched well with the observed network. Our metrics were able to be projected effectively across a large landscape and could be useful indicators of impacts on wildlife habitats in future simulations.

This model was developed with the goal of being simple to use, readily accessible, and relatively accurate across a large landscape. With minimal input parameters, complexity, and computational power, one can project future forest road networks using this tool across large areas which can aid in the assessment of potential impacts of forestry disturbance on wildlife and habitat over a large spatial scale. With land use activities transforming a large proportion of the planet's land surface and becoming an issue of global importance (Foley et al., 2005), there is an increasing need to improve and build upon landscape level models in order to properly manage and protect remaining natural habitats. Land-use activities, primarily for agricultural expansion and timber extraction, have caused a net loss of \~7 to 11 million km2 of forest in the past 300 years (Foley et al., 2005). With only 7% of the planet's roadless areas being larger than 100 square kilometers, there is a need to protect key areas which sustain key refugia for biodiversity from fragmentation and degradation (Ibisch et al., 2016). The introduction of this widely applicable and user-friendly forest resource road model is a step in the right direction for providing more tools to land managers and planners who are interested in assessing the potential impacts of road development over large landscapes.

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```

# Appendix

## Road network projection methods

Various optimization and simulation techniques have been used for projecting forestry roads into the future and across landscapes, however, we focused on the simulation methods that link multiple harvest units (a.k.a cutblocks) to an existing road network for strategic purposes. Dean (1997) described this road projection problem as the multiple target access problem (MTAP), where the objective is to find the minimum-cost locations for new roadways that link forested stands or landings (i.e., log deck) to the existing road network. We used three methods for solving the MTAP in the roads package. These methods represent a gradient of computational complexity and operational detail, starting with the least complicated or the snapping approach, followed by the least cost paths approach (LCP) and finally, the minimum spanning tree approach (MST). In the remainder of this paper, we will focus on the LCP and MST approaches given their assumptions are well aligned with how forestry professionals would strategically design road networks.

LCP approach solves the MTAP by decomposing the problem into several smaller problems called single target access problems (STAP). For each STAP, a least cost path from a single source to sink was solved using Dijkstra's shortest path algorithm (1959). Dijkstra's algorithm minimizes the distance between a landing and the current road network, subject to costs or penalties incurred from road construction and travel (the details of this process are described later in the section "weighted graph"). Each STAP was then solved sequentially, with the newly projected roadway updating the existing road network and subsequently the costs of road construction. This method was first developed by Anderson and Nelson (2004) and provides a feasible solution to the MTAP, however the projected network is sensitive to the ordering of the STAP. They recommended a heuristic for connecting the landings and finding optimal branch locations to deal with this sensitivity.

The MST approach extends the LCP approach by providing a heuristic for linking landings or evaluating road branching opportunities. Dean (1997) showed that heuristics with branch evaluation were able to reproduce 80% of the observed road locations in their study area. Our MST approach has three steps towards evaluating branch locations while projecting roads: 1) estimate the least cost paths that link each of the landings and the least cost paths that link each landing to the existing road network, 2) creating a weighted graph where each node is either a landing or point on the existing road network and each edge or arc is weighted by the costs estimated in the previous step and 3) solving the minimum spanning tree for this graph. The minimum spanning tree was solved using Kruskal's algorithm (1956) where every node in the graph was linked to form a tree such that the sum of edge weights is minimized, and the links do not form a loop. This method was most similar to Clark et al. (2000) approach which used a minimum spanning tree to project simple road networks during harvest scheduling. An important difference was that they based the edge weights on spatial Euclidean distance, whereas the MST approach used the costs estimated from least cost paths.

A projection created with the Forest Road Network Plugin for QGIS by Clement (2021) was also created within QGIS and added to the analysis in order to see how it compared with our projection methods. All the default settings such as skidding distance, etc. were left as they were within the QGIS plugin.

## Weighted graph

A mathematical weighted graph consisting of nodes and edges was used to parameterize either Kruskal's or Dijkstra's algorithms. When solving least cost paths using Dijkstra's algorithm, each node in the graph corresponded to a pixel in a raster of our study area (100m x 100m resolution). Whereas, in the graph used for solving the minimum spanning tree via Kruskal's algorithm, each node represented either a landing or a point on the existing road network. Therefore, a node can be represented by any one of three attributes in the forest road network: (i) a landing, (ii) a point on an existing road, or (iii) an intermediate point. The landing nodes represent log decks or sources of timber and the point on the existing road is the sink where the timber will end up. The intermediate points are plausible locations to construct a road and are thus free of barriers like major water bodies. [The edges connecting the nodes follow a "queens" case or allow a maximum of eight possible edges for a given node.]{.underline} Thus, our methods utilize a grid pattern which does not support curvature or switchbacks in road design as required in operational road design, thus we ascertain that our road projection methods are for strategic modelling purposes only. Edges are assigned weights which penalize the algorithm to account for various impedance and road construction costs. When solving least cost paths, a cost surface raster was used. The pixels of the cost surface raster corresponded to nodes in the weighted graph and thus the edge weight was the average cost between the two nodes or pixels. When solving the minimum spanning tree, the edge weight corresponded to the total cost of the least cost path between the two nodes.
