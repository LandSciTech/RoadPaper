---
title: "Implementation and assessment of tools for integrating forest roads into projections of the cumulative effects of disturbance on wildlife"
author:
  - name: Josie Hughes
    email: josie.hughes@ec.gc.ca
    institute: [ECCC]
    correspondence: true
    equal_contributor: "yes"
    orcid_id: 0000-0001-7875-9015
  - name: Sarah Endicott
    email: sarah.endicott@ec.gc.ca
    institute: [ECCC]
    correspondence: false
    equal_contributor: "yes"
  - name: David Lapins
    email: david.lapins@pc.gc.ca
    institute: [ECCC]
    correspondence: false
  - name: Gregory Paradis
    email: gregory.paradis@ubc.ca
    institute: [UBC]
    correspondence: false
  - name: Kyle Lochhead
    email: Kyle.Lochhead@gov.bc.ca
    institute: [FLNR]
    correspondence: false

institute:
  - ECCC: Environment and Climate Change Canada 
  - FLNR: British Columbia Ministry of Forests 
  - UBC: University of British Columbia 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      number_sections: no
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: Roads.bib
csl: "../templates/canadian-journal-of-forest-research.csl" # Insert path for the bib-style
abstract: |
  Despite a rapidly growing body of evidence of complex and varied impacts of road networks on wildlife and other values, and increasing use of spatial stochastic models for forecasting impacts of forest disturbance across regions, very few spatial stochastic projections of forest disturbance dynamics have included road network projections, in part because tools suited for this purpose have not been available. Hardy et al. [-@hardy_landis-ii_2023] partially addressed this need with a Landis-II extension. As a complementary and comparable alternative, we provide implementations of simple iterative least cost path and minimum spanning tree methods in an open source R package that can be easily integrated into R workflows and modelling frameworks used for forecasting forest change in Canada and elsewhere. Comparison of these methods in a mountainous region of British Columbia clarifies that performance is adequate according to some metrics but not others, that aspatial performance metrics obscure important differences in alorithm behaviour within and outside cutblocks, and that none of these algorithms mimic switchbacks in steep terrain. Method assessment is complicated by errors in available in cutblock and forest road data. Simple iterative least cost path road network simulation methods may be adequate for projecting important impacts on wildlife across large areas, and we hope that more easily useable open source implementations will help integrate resource roads into forest change projections.
keywords: |
  keyword 1; keyword 2; keyword 3
editor_options: 
  chunk_output_type: inline
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

<!-- Link to data here: https://drive.google.com/file/d/179lw6MPK4l3xGmded9kofzJkB6VlJVb9/view?usp=sharing -->

```{=html}
<!-- TO DO CJFR guidelines to note:
* 6000 words, 50 references - need to remove ~30 refs
* abstract 200 words
* page #s
* double spacing
* affiliation - insitution, city, prov, country
* CMJE definition of authorship - need CRedit author contribution statement
* need funding statement, data availability statement, competing interests
* review figure guidance
-->
```
Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Introduction

The impacts of roads on wildlife are complex and varied. Mortality risk and stress on or near roads can be elevated due to vehicle collisions, hunting pressure, predation, noise and other stressors, but roads can also provide food, facilitate movement, and provide refuge [@hill_review_2021; @trombulak_review_2000; @fahrig_effects_2009]. In Canadian forests, there is ample evidence of linear features attracting predators such as bears (*Ursus americanus*, *Ursus arctos*) and wolves (*Canis lupus*) seeking food or easy movement, while repelling prey such as woodland caribou (*Rangifer tarandus caribou*) and moose (*Alces americanus*) [@dickie_corridors_2020; @polfus_identifying_2011; @mumma_predation_2018; @beauchesne_disentangling_2013; @leblond_avoidance_2013; @laurian_interactions_2012]; there is also evidence of predators avoiding features heavily used by humans [@muhly_human_2011; @whittington_towns_2022; @proctor_effects_2020]. Changes in mortality risks, habitat quality, and connectivity associated with anthropogenic disturbance can in turn alter use and movement patterns [@tucker_moving_2018; @apps_factors_2006; @proctor_effects_2020], demography and population viability [@johnson_science_2020; @decesare_linking_2014; @barrientos_lost_2021; @apps_spatial_2013; @pinard_calving_2012; @fahrig_effects_2009; @lochhead_linking_2022; @apps_spatial_2013; @proctor_effects_2020], and genetics [@habrich_varying_2021]. Roads can also facilitate spread of invasive species [@riitters_landscape_2017], and enable other development activities [@johnson_growth-inducing_2020].

Increasingly rapid environmental change, improvements in available cyberinfrastructure, and development of open source data, tools and methods have contributed to growing interest in ecological forecasting models [@bodner_bridging_2021; @dietze_ecological_2017; @mcintire_perfict_2022]. In particular, forest landscape models that can account for harvest, fire, and other disturbances are widely and increasingly used to project the cumulative effects of climate change and forest management [@petter_how_2020; @albrich_simulating_2020; @hof_editorial_2021; @tremblay_harvesting_2018; @snell_importance_2018; @daniel_incorporating_2017; @stewart_climate-informed_2023; @micheletti_assessing_2021; @leblond_there_2022; @bouderbala_long-term_2022; @barros_empowering_2023; @labadie_global_2023], building on a rich history of spatial-stochastic models of forest growth and succession following disturbance [@sturtevant_understanding_2021]. Despite the importance of roads for wildlife, very few of these projections have included road networks. For example, in a recent collection of articles focused on "Using Landscape Simulation Models to Help Balance Conflicting Goals in Changing Forests" [@hof_editorial_2021], only one includes a road projection [@leston_quantifying_2020].

While road projection tools are not typically used in forest landscape models, they are important for harvest planning, and methods [@anderson_projecting_2004; @clark_three-stage_2000; @dean_finding_1997; @epstein_combinatorial_2006; @meignan_heuristic_2012; @stuckelberger_improved_2007] and tools [e.g. @remsoft_remsoft_2019; @spatial_planning_systems_patchworks_nodate] exist to accomplish this task in an operational context. These have occasionally been incorporated into forest landscape models [@leston_quantifying_2020] but they were not designed for that purpose. The algorithms contained in proprietary closed-source software are difficult to assess or fully integrate into models that include stochastic disturbances [@sturtevant_understanding_2021; @de_pellegrin_llorente_recognizing_2017] and the level of detail required to parameterize them is often difficult to obtain at landscape scales. Harvest road planning tools may produce more accurate road projections but the cost of preparing and running them can be prohibitive in contexts where a rougher approximation of road locations may suffice.

Promising options for integrating forest road network projections into large scale stochastic projections of forest change include an iterative least cost path method developed by Hardy et al [-@hardy_forest_2019; -@hardy_landis-ii_2023], and least cost path and minimum spanning tree algorithms used to project roads and reconstruct development history in British Columbia [@lochhead_demo_2018; @lochhead_linking_2022]. The former method is available as QGIS and Landis-II extensions, and the latter is embedded in a larger open source modelling project that is specific to British Columbia [@muhly_castor_nodate]. Hardy's tool is designed for integration with other components of the Landis-II modelling framework [@scheller_design_2007; @labadie_global_2023], but none of the existing implementations can be easily integrated into the full variety of modelling frameworks used for forecasting forest change in Canada and elsewhere [e.g. @barros_empowering_2023; @daniel_state-and-transition_2016].

To help address the need for adequately accurate forest road network projection tools that can be easily integrated into stochastic models of forest change we implemented simple iterative least cost path and minimum spanning tree methods [@lochhead_demo_2018; @lochhead_linking_2022] in an open source R package. We compared the ability of these methods and Hardy's method [-@hardy_forest_2019; -@hardy_landis-ii_2023] to reconstruct observed forest road network development since 1990 in a mountainous region of British Columbia. The adequacy of a road network projection method depends on the purpose of the projection, so it is important to select performance metrics that reflect the purpose. Given our interest in projecting impacts on wildlife we focus on several common predictors of the impacts of roads on wildlife, including distance to roads [@labadie_global_2023], buffered disturbance footprint [@johnson_science_2020; @ibisch_global_2016; @lochhead_linking_2022; @polfus_identifying_2011; @labadie_global_2023; @stewart_climate-informed_2023], and road density [@apps_factors_2006; @apps_spatial_2013; @serrouya_time_2017].

```{=html}
<!-- TO DO:
- more thorough review of SMC & grizzly papers
- summarize road metric types used in cited papers more systematically.
-->
```
```{=html}
<!--
See notes here:
https://docs.google.com/document/d/1UQ_iC69QX0qX86NM6zSSQ036CgslN-uCXCdBY-4nU5M/edit
Effects of roads on wildlife include increased mortality from various types of encounters with humans, alterations in behaviour and interactions among predators and prey, and spread of invasive species (Trombulak and Frissel 2001). In boreal forests and coniferous forests of the Columbia and Rocky mountains, notable impacts of logging roads include facilitation of movement by wolves (Mumma et al. 2018; Dickie et al. 2020), attraction of bears to roadside food resources (Roever et al. 2010; Bastille-Rousseau et al. 2011; Dickie et al. 2020), increased mortality caused by humans near roads and trails (Roever et al. 2010), and avoidance by ungulates (Laurian et al. 2015; Dickie et al. 2020). Forest dwelling boreal woodland and mountain caribou avoid roads leading to a loss of available habitat (Polfus et al. 2011; Dickie et al. 2020), and suffer increased mortality near roads (Bastille-Rousseau et al. 2011; Mumma et al. 2018). At a range scale, survival and recruitment of boreal caribou declines with anthropogenic disturbance (Johnson et al. 2020). Eight herds of Southern Mountain Caribou have been extirpated or likely extirpated, and remaining herds are considered Endangered by COSEWIC  and listed as threatened under the Canadian Species at Risk Act (SARA) (Palm et al. 2019). Most boreal caribou populations with ranges that include intensive forest management activity are not self-sustaining (ECCC 2011; Johnson et al. 2020), and boreal caribou are also listed as threatened under SARA.

Nonlinear responses of elk to road density (Frair et al. 2008). Black bear responses to roads vary with road type (Zeller et al. 2020), and selection for roadside vegetation can increase neonatal boreal woodland caribou mortality in areas near roads . 
For more careful reading: Flyal et al. 2019; Jaeger et al. 2005; Laurance et al. 2014; Psaralexi et al. 2017; Apps et al 2014; Beyer et al. 2014; Blagdon and Johnson 2021; Suzuki and Parker 2016; Fahrig and Rytwinski 2009; Coffin et al. 2021; Crist et al. 2005; Grantham et al. 2020;Johnson et al. 2019; Meijer et al. 2018; Langeveld et al. 2009

<!-- value of roadless areas: [@ibisch_a_2016; @talty_conservation_2020; @psaralexi_importance_2017] -->

<!-- forest mgmt planning models: [@depellegrinllorente_recognizing_2017] -->

<!-- other of interest: caribou habitat metric [@whitman_a_2017] -->

<!-- Resource extraction, such as forest harvesting, is the main driver of road construction in much of Canada's forested area. In British Columbia, over 600 000 kilometers of resource roads make up the vast majority of the province's total road network (83%) (Environmental Reporting BC, 2018; Forest Practices Board, 2015). Over 75% of resource roads in the province were built by the forest industry (Forest Practices Board, 2015). -->

<!-- Forest simulation models generally either fall into two categories: deterministic and stochastic (Boychuk et al., 2009; Helmes & Stockbridge, 2011). -->

-->
```
# Methods

## Study Area and Data

We chose the Revelstoke timber supply area (TSA 27) in British Columbia, Canada as an assessment area because it is mountainous (Figure \@ref(fig:study-area)), containing approximately 38% non-forested land [@british_columbia_ministry_of_forests_revelstoke_2022] where road building is difficult or impossible. Thus, the area provides opportunities to observe the behaviour of road projection algorithms in steep complex terrain. Forestry is the dominant resource extraction activity and much of the road network was built to access forest harvest cutblocks, allowing projection of the road network from historic forest harvest data. The Revelstoke TSA includes portions of the Monashee and Selkirk mountain ranges, and is bisected by the Columbia River. At low to mid-elevations, forests of the interior cedar-hemlock biogeoclimatic zone [@british_columbia_ministry_of_forests_and_range_biogeoclimatic_nodate] include remnants of rare old growth inland temperate rainforest [@government_of_canada_parks_canada_agency_old_2017]. At higher elevations, forests are dominated by Englemann spruce and subalpine fir [@british_columbia_ministry_of_forests_and_range_biogeoclimatic_nodate]. The area is within the ancestral territories of the Ktunaxa Nation, Secwepemc Nation, Syilx and Sinixt [@british_columbia_ministry_of_forests_revelstoke_2022]. Two of six southern mountain woodland caribou herds in the area have been extirpated, and the remaining herds are considered Endangered by COSEWIC and listed as threatened under the Canadian Species at Risk Act [@palm_long_2020; @british_columbia_ministry_of_forests_revelstoke_2022; @environment_canada_recovery_2014]. Mountain caribou avoid roads leading to a loss of available habitat [@polfus_identifying_2011; @apps_factors_2006], suffer increased mortality near roads [@apps_spatial_2013], and decline in abundance as the footprint of roads and cutblocks increases [@lochhead_linking_2022]. Roads also alter grizzly habitat use, home range selection, movements, population fragmentation, survival, reproductive rates, population density, trends, and conservation status [@proctor_effects_2020].

```{=html}
<!--        TO DO: consider these comments from Kyle: Need a description about road development. In BC, forestry roads are developed by forest licensees under a timber harvesting permit. Various considerations go into road development including soils, grade, and economics. What type/classification of roads are you looking at (primitive roads, paved roads, etc). What’s the maximum grade? ---can find a lot of this verbiage in the Interior Appraisal Manual. How are they maintained – do they last forever -see Auditor General Report 
•        How much of the Revelstoke TSA overlaps with caribou range? Elevation? Climate? Flora/Fauna?
•        Maybe add a table of descriptive statistics presenting information about roads in the Revelstoke TSA and the other TSAs you mention? By Caribou Range? – road density, road length, cutblock area, cutblock density, etc
-->
```
```{r setup2}
library(ggplot2)
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
library(ggpubr)
library(MetBrewer)
library(here)
library(tmap)
library(sf)

devtools::load_all(here())

#set paths
data_path_raw <- "analysis/data/raw_data/"
data_path_drvd <- "analysis/data/derived_data/TSA27"

pal_nm <- "Redon"

fig_widths <- c(min = 1.18, single = 3.543, mid = 5.51, two = 7.48)
```

```{r study-area, fig.cap="Road construction costs according to a simple model informed by slope and major barriers (Table 1) in the Revelstoke timber supply area in British Colombia, Canada.", cache=TRUE}
tsaBoundary <- read_sf(here(data_path_raw, "tsa27_boundaries.gpkg"))
#cost surface raster layer
tsaCost <- terra::rast(here(data_path_drvd, "input_cost.tif"))

tsaCost <- terra::mask(tsaCost, terra::vect(tsaBoundary))

canada <- geodata::gadm("CAN", level = 1, path = here(data_path_raw))

canada <- canada %>% 
  st_as_sf() %>% 
  filter(COUNTRY == "Canada") %>% 
  st_transform(st_crs(tsaBoundary)) %>% 
  st_simplify(dTolerance = 10000)

canada_overlay <- tm_shape(canada, projection = "+proj=lcc +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs")+
  tm_borders(col="black")+
  tm_shape(st_buffer(tsaBoundary, 10000))+
  tm_polygons(border.col = met.brewer(pal_nm, 1), col = met.brewer(pal_nm, 1))+
  tm_layout(frame=TRUE)

tsa <- tm_shape(tsaCost, name = "Cost")+
  tm_raster(style = "cont", title = "Cost",palette="Greys")+
  tm_shape(st_union(tsaBoundary))+
  tm_borders(col = "black")+
  tm_compass(position = c(0.3, 0.11), size = 1)+
  tm_scale_bar(position = c("center", "bottom"), text.size = 1)+
  tm_layout(legend.position = c("left", "bottom"),
            legend.bg.color = "white")
  

vp <- grid::viewport(x=0.965, y=0.945, width = 0.35, height=0.2,
               just=c("right", "top"))

tmap_save(tsa, filename = here("analysis/figures/Figure1_StudyArea.png"),
  dpi = 600, insets_tm = canada_overlay, insets_vp = vp,
  height = 6, width = fig_widths["single"], units = "in")

knitr::include_graphics(here("analysis/figures/Figure1_StudyArea.png"))

```

Road network data was obtained by combining the digital road atlas [@data_bc_digital_2021] and forest tenure road [@british_columbia_ministry_of_forests_lands_natural_resource_operations_and_rural_development__flnrord_forest_2021] data sets for British Columbia. To avoid situations where the same road was included in both data sets with slightly different coordinates, we removed all roads from the digital road atlas that were within 50 m of forest tenure roads. The existing road network, used as the starting point for projections, was created by filtering out forest tenure roads with an award date greater than 1990. We assumed everything in the digital road atlas was built before 1990. Cutblock information was obtained from the Harvest Areas of BC (Consolidated Cutblocks) dataset [@government_of_british_columbia_harvested_2021], compiled from provincial Forest Cover, the RESULTS Reporting system, Forest Tenure applications, and satellite imagery using change detection processes. The data does not exclude non-harvested 'reserved' areas, and satellite image change detection may not always represent the entire cutblock area [@government_of_british_columbia_harvested_2021]. Forest harvest cutblocks with harvest years greater than 1990 were filtered and used as targets for the projections.

Following the Interior Appraisal Manual of BC, we assume the base cost of construction per kilometer of road is a linear function of slope [@government_of_british_columbia_interior_2021], and that road construction across major water bodies is prohibitively expensive (Table \@ref(tab:cost-tbl)). Existing roads are assigned a cost of 0. The road construction cost raster consists of 1,703,936 pixels with a resolution of 1 ha.

```{r cost-tbl}
tbl <- "Cost Type|Value ($ per km)|Source
Slope|16178 + 504*slope|Interior appraisal manual
Major lakes|NA|Major water bodies of BC
Existing roads|0|Digital road atlas and forest tenure roads for BC
"
df <- read.delim(textConnection(tbl),header=FALSE,sep="|",strip.white=TRUE,stringsAsFactors=FALSE)
names(df) <- unname(as.list(df[1,]))
df <- df[-1,] # remove first row
row.names(df)<-NULL
knitr::kable(df, caption = "A simple model of road construction costs.")
```

All data sets were accessed using the `bcdata` R package and filtered to the extent of the Revelstoke Timber Supply Area [@teucher_bcdata_2021]. These data sets are continuously updated so we have stored the versions used in our analysis in an Open Science Framework repository [@endicott2024a]. We were not granted permission to share the digital road atlas so it must be accessed from the B.C. Data Catalogue [@governmentofbritishcolumbia]. Scripts used for data acquisition and analysis associated with this paper are available on GitHub [@endicott2024].

## Road Projection Methods and Variants

We focus on methods that link multiple target locations to an existing road network for strategic purposes by finding minimum-cost locations for new roadways that link landings within harvest cutblocks (i.e., log decks) to the existing road network, described by Dean [-@dean_finding_1997] as the multiple target access problem (MTAP). Specifically, we compare iterative least cost path (ILCP) and minimum spanning tree approaches (MST) for solving the MTAP to an alternative iterative least cost path method developed by Hardy [-@hardy_forest_2019; -@hardy_landis-ii_2023] (Figure \@ref(fig:proj-meth-fig)).

The ILCP approach solves the MTAP by decomposing the problem into several smaller single target access problems (STAPs). For each landing target, the least cost path to the existing road network is solved using Dijkstra's shortest path algorithm [-@dijkstra_note_1959]. The algorithm is parameterized with a weighted graph wherein each node corresponds to a raster pixel representing one of three components of the potential forest road network: a landing, a point on an existing road, or an intermediate point that is a plausible location for road construction. Each node is connected with up to eight neighbours, and the cost of construction along edges is weighted by the distance to neighbouring nodes and the average of the construction cost at the source and destination nodes (Table \@ref(tab:cost-tbl)). The simple underlying grid is less computationally costly than methods designed to support curvature or switchbacks required in operational road design [@stuckelberger_improved_2007]. The algorithm starts with the landing nearest to an existing road, and updates the existing road network and construction cost surface with each new road segment before moving on to the next nearest landing. The method was developed by Anderson and Nelson [-@anderson_projecting_2004] who noted that the projected network is sensitive to the ordering of targets and recommended a heuristic for connecting the targets and finding optimal branch locations to deal with this sensitivity.

The MST approach extends the LCP approach by providing a heuristic for linking landings and evaluating road branching opportunities. Dean [-@dean_finding_1997] showed that heuristics with branch evaluation were able to reproduce 80% of the observed road locations in their study area. The first step in our MST approach is to estimate the least cost paths that link each of the landings and the least cost paths that link each landing to the existing road network. These results are used to create a weighted graph wherein nodes are either landings or points on the existing road network, and edge weights correspond to the total cost of the least cost path between pairs of nodes. The minimum spanning tree for this graph is solved using Kruskal's algorithm [-@kruskal_shortest_1956], which links all nodes with a tree that minimizes edge weights and does not include loops. This method differs from Clark et al. [@clark_three-stage_2000] who used Euclidean distances for edge weights.

Hardy's method [-@hardy_forest_2019; -@hardy_landis-ii_2023] is similar to our ILCP method in that it breaks the MTAP down into many STAPs and finds the least cost path for each with the ordering of road construction determined by the distance from the existing road network. One difference is that Hardy uses the Dijkstra algorithm to solve a “single-source many-targets shortest path problem”, which is a special case of STAPs that finds the path between the harvested cell and one of multiple potential connection points on the road network. In contrast our algorithm first finds the closest point on the road network to the selected landing point and then uses the Dijkstra algorithm to solve least cost path between the two. However, since the cost of construction on existing roads is zero we expect that in practice these two approaches are similar and the algorithm will select the least cost location for the road to connect to the existing road network. It is possible that a sub-optimal road connection location is chosen by our algorithm when the existing road network is not fully connected and the closest point is on an existing road fragment that is not connected to the optimal part of the road network. Within cutblocks, Hardy's method iterates over each cell in the harvest area and builds a road if it is not within skidding distance of an existing road, while we create landing points to serve as target locations for road construction.

```{=html}
<!--
TO DO: should this paragraph about speed and memory go in the results or discussion rather than methods?
-->
```
The MST method is expected to be closer to an optimal solution than iterative least cost path methods, and also more computationally costly. The Hardy QGIS plugin is much faster than our R package, and better able to handle large landscapes. The `igraph` package that we used to implement the Dijkstra algorithm requires the values of the cost raster to be read into memory in R which can lead to high memory usage on larger landscapes. See Appendix X for a more detailed exploration of the speed and memory requirements of the different methods.

The ILCP and MST methods connect landings within each cutblock to the existing road network, so an important first step is to select one or more landing locations in each block. We investigated the sensitivity of results to the pattern and density of landing locations by comparing results derived from the centroid of each cutblock to regular or randomly selected landing densities of 1 (low) and 10 (high) points per km^2^ (Figure \@ref(fig:proj-meth-fig)). We used default settings in the Hardy QGIS plugin except for skidding distance which was set to 200m. A skidding distance of 200 m corresponds to \~ 9 pts/km^2^. We compared two resolutions of the cost surface by aggregating the 1 ha resolution cost raster to a coarser 100 ha (1000 by 1000 m) resolution. In total, we compared 12 road projection method variants to a cutblocks only scenario with no projected roads (Table \@ref(tab:method-tbl)).

```{r method-tbl}
tbl2 <- "Projection method|Sample type|Sample density (pts/km^2^)|Resolutions
MST grade penalty & simple cost|Regular|1|1 & 100 ha
MST grade penalty & simple cost|Regular|10|1 & 100 ha
MST grade penalty & simple cost|Random|1|1 & 100 ha
MST grade penalty & simple cost|Random|10|1 & 100 ha
MST grade penalty & simple cost|Centroid|N/A|1 & 100 ha
ILCP grade penalty & simple cost|Regular|10|1 ha 
Hardy QGIS|N/A|~9|1 ha
Cutblocks only|N/A|N/A|1 ha

"
df2 <- read.delim(textConnection(tbl2),header=FALSE,sep="|",strip.white=TRUE,stringsAsFactors=FALSE)
names(df2) <- unname(as.list(df2[1,]))
df2 <- df2[-1,] # remove first row
row.names(df2)<-NULL
knitr::kable(df2, caption = "Road projection method variants.")
```

To help make these road network projection methods more easily and widely useable, we implemented the ILCP and MST methods in the open source R package `roads` [@endicott_roads_2023]. The `roads` package is dependent on several other R packages that made this work possible, including, among others: `igraph` for calculating least cost paths and minimum spanning trees [@csardi_igraph_2006; @noauthor_igraph_2022], `terra` for manipulating spatial raster data [@hijmans_terra_2023], and `sf` for manipulating spatial vector data [@pebesma_simple_2018; @pebesma_sf_2022]. The package is available on CRAN (The Comprehensive R Archive Network) and the source code, tutorials and documentation are available on GitHub [@endicott_roads_2023].

```{r, cache=TRUE}
# Example area for demonstrating different methods

library(dplyr)
library(sf)
library(roads)
library(terra)
library(tmap)
library(purrr)
library(caribouMetrics)
#library(pfocal)

# read in example area data
exRoads <- read_sf(here(data_path_drvd, "..", "testing_ex_roads.gpkg"))
tsb <- read_sf(here(data_path_drvd, "..", "testing_tsb.gpkg"))
cutblocks <- read_sf(here(data_path_drvd, "..", "testing_cutblocks.gpkg"))
tsaCost <- raster::raster(here(data_path_drvd, "..", "testing_cost.tif"))
roads <- read_sf(here(data_path_drvd, "..", "testing_obs_roads.gpkg"))

# densities
high <- 0.00001
low <-  0.000001

sampleDens <- c(high, high, low)
sampleType <- c("regular","random","centroid")
paramTable <- tibble(sampleType, sampleDens,
                     method = "mst",
                     runTime = vector("list", length(sampleDens)),
                     output = vector("list", length(sampleDens)),
                     roadDisturbance = vector("list", length(sampleDens)),
                     roadDensity = vector("list", length(sampleDens)),
                     roadPresence = vector("list", length(sampleDens)),
                     distanceToRoad = vector("list", length(sampleDens)),
                     forestryDisturbance = vector("list", length(sampleDens))) %>%
  distinct()

# re-run projections for just the small area with different parameters
mstProj <- projectAll(tsbs = tsb, paramTable = paramTable,
                      weightRaster = tsaCost,
                      cutblocks = cutblocks,
                      existingRoads = exRoads,
                      fileLocation = here(data_path_drvd, "..", "for_fig"),
                      roadsInWeight = F)

ilcpProj <- projectAll(tsbs = tsb,
                      paramTable = paramTable %>% 
                        filter(sampleType == "regular") %>% 
                        mutate(method = "ilcp"),
                      weightRaster = tsaCost,
                      cutblocks = cutblocks,
                      existingRoads = exRoads,
                      fileLocation = here(data_path_drvd, "..", "for_fig"),
                      roadsInWeight = F)

allProj <- bind_rows(mstProj, ilcpProj, .id = "method") %>%
  arrange(desc(sampleType), sampleDens)

# add Hardy QGIS results for the same area

allProj <- bind_rows(
  allProj,
  tibble(sampleType = "", sampleDens = 0, method = "Hardy QGIS",
             output = list(here(data_path_drvd, "..", "for_fig", 
                                "HardyQGISTest.gpkg")))) %>% 
  mutate(mapTitle =  paste(ifelse(method == 1, "MST",
                                  ifelse(method == 2, "ILCP", method)),
                           sampleType,
                           ifelse(sampleDens == 1e-06 & 
                                    sampleType != "centroid", "low density", 
                                  ifelse(sampleDens == 1e-05, 
                                         "high density", ""))))

# add extra row for legend
allProj <- bind_rows(allProj, 
                     slice(allProj, 1))

allMaps <- purrr::map(
  1:nrow(allProj),
  ~ qtm(cutblocks, borders = "#92c5de", fill="#92c5de", borders.lwd = 1,)+
    qtm(tsaCost, raster.style = "cont", raster.palette = "Greys",
        raster.alpha = 0.25, raster.title = "Cost")+
    qtm(roads, lines.col = "#0571b0", lines.lwd = 2,lines.lty="solid")+
    qtm(read_sf(here(allProj$output[[.x]])), lines.col = "#ca0020", lines.lwd = 2)+
    qtm(exRoads, lines.col = "black", lines.lwd = 2)+
    tm_layout(legend.show = .x == nrow(allProj),
              legend.only = .x == nrow(allProj),
              main.title = allProj$mapTitle[[.x]],
              main.title.size = 0.75))

allMaps[[nrow(allProj)]] <- allMaps[[nrow(allProj)]]+
  tm_add_legend(type = "line", 
                labels = c("Existing roads", "Projected roads", "Observed roads"),
                col = c("black", "#ca0020", "#0571b0"),lty=c("solid","solid","solid"))+
    tm_add_legend(type = "fill", 
                labels = "Cutblocks",
                col = "#92c5de", border.col ="#92c5de")+
  tm_layout(legend.only = TRUE, legend.position = c("center", "center"))

tmap_save(tmap_arrange(allMaps, ncol = 3),
          here("analysis/figures/projection_methods_figure.png"),
          dpi = 300, height = 5, width = fig_widths["two"])
```

```{r proj-meth-fig, fig.cap="Comparison of minimum spanning tree (MST), iterative least cost paths (ILCP), and the Hardy QGIS plugin road network projection algorithms. Landing locations were selected as the centroid of the cutblock, or a random or regularly spaced sample of points inside each cutblock (Table 2). Target cutblocks are outlined in grey, existing roads are black, projected roads are yellow, observed roads are red. Cost (1 ha resolution) is indicated by grey shading. The large four sided cutblock in the top right was added to more clearly show algorithm behaviour within cutblocks."}
knitr::include_graphics(here("analysis/figures/projection_methods_figure.png"))
```

## Performance Metrics

To assess performance we calculated five characteristics of the projected and observed road networks: road presence, measured as whether or not roads are present in each pixel; road density, measured as density of roads in meters per hectare (m/ha); distance to nearest road, measured as distance from each raster cell to the nearest road; road disturbance footprint, measured with a 1 km buffer around roads [@ibisch_global_2016]; and forestry disturbance footprint, measured with a 500 m buffer around roads and cutblocks. The forestry disturbance footprint is a variant of the buffered anthropogenic disturbance metric that is used as an indicator of boreal caribou critical habitat [@johnson_science_2020] and to quantify impacts of disturbance on Southern Mountain caribou [@lochhead_linking_2022; @polfus_identifying_2011]. The other metrics are also often used in studies of anthropogenic impacts on wildlife [e.g. @labadie_global_2023; @stewart_climate-informed_2023; @apps_factors_2006; @apps_spatial_2013; @serrouya_time_2017]. Forestry disturbance footprint and road density were calculated using the *disturbanceMetrics* and *rasterizeLineDensity* functions in the `caribouMetrics` R package [@hughes_cariboumetrics_2022]. Distance to nearest road was calculated using a fast parallel moving window method implemented in the *getDistFromSource* function of the `roads` package.

<!-- TO DO: Discuss why we do not calculate the 50m buffer metric used by Kyle for SMC. 50 m buffer is basically built in to the 100 m raster resolution. Road presence would be our closest equivalent measure - and we don't project that measure very well. -->

Aspatial performance of the projections was assessed by comparing projected and observed mean values of each road network characteristic across the timber supply area and within cutblocks. We further distinguished mapped cutblocks that contain observed roads from those that do not to reduce errors associated with open areas that have been misidentified as cutblocks. Spatial performance was assessed in two different ways. First, difference maps were created by subtracting the projected distance to the nearest road from the observed in order to highlight discrepancies between the road networks. The observed and projected road networks were then overlain on the difference maps and regions of major discrepancies were investigated using Google satellite imagery in QGIS. Second, performance according to the three binary metrics (road presence, road disturbance footprint, and forestry disturbance footprint) was assessed by categorizing pixels of a projected raster into 5 categories compared with the observed raster: pre-existing footprint; agree roadless, meaning that both projected and observed show no footprint; agree roaded, meaning that both projected and observed show new footprint; false positive, meaning the projection shows a footprint but no footprint was observed; and false negative, meaning the projection shows no footprint but a footprint was observed. These categories were summarized for each projection and characteristic and used to calculate sensitivity, precision and F-measure of each metric [@lee_prediction_2021]. Sensitivity, also known as recall, gives the proportion of the true positives that were projected, while precision gives the proportion of positives projected that are true. Sensitivity will be lower when observed roads are missed and precision will be lower when roads are projected that were not observed. F-measure attempts to balance sensitivity and precision to give an overall score.

# Results

## Aspatial performance

For each projection method variant the aspatial performance varied across the five road network metrics and also varied depending on whether we consider scores within cutblocks, outside cutblocks, or overall (Figure \@ref(fig:aspat-perf-fig)). Within all mapped cutblocks (Figure \@ref(fig:aspat-perf-fig-all)), the Hardy method most accurately projected road density, and least accurately projected distance to road. Low density method variants most severely underprojected road density within cutblocks, and most accurately projected distance to road within cutblocks (Figure \@ref(fig:aspat-perf-fig-all)). These apparently contradictory results are explained by areas in our input data that have been misidentified as cutblocks with no associated observed roads (e.g. Figure \@ref(fig:proj-map-fig)b). Omitting cutblocks without observed roads from the analysis (Figure \@ref(fig:aspat-perf-fig)) clarifies that within real cutblocks the Hardy method most accurately projected road density and distance to road. However, note that our observed landscape is densely roaded in part because switchbacks are required in steep terrain , and the Hardy method projects a distinctly different pattern of road tortuosity within cutblocks (Figure \@ref(fig:proj-meth-fig)). None of the methods considered here can project switchbacks (Figure \@ref(fig:proj-meth-fig)).

Another fundamental limitation of these methods is that they generate straight road segments within pixels. As raster resolution increases, the discrepancy within pixels between real roads and straight projected segments increases, which explains why projections of road density are less accurate when the cost raster resolution is coarse (Figure A-\@ref(fig:figA1)). In contrast, projections of the proportion of cells that contain roads is more accurate on a coarse raster (Figure A-\@ref(fig:figA1)).

Outside cutblocks, all method variants underproject road density and road presence, and there is little variation in performance among them (Figure \@ref(fig:aspat-perf-fig)). Comparison of observed and projected road networks clarifies that projected roads cross valley bottoms far more often than observed roads which often run parallel to one another on each side of rivers (Figure \@ref(fig:proj-map-fig)a). Accounting for the costs of crossing streams, rivers and other wet areas in valley bottoms would likely reduce this discrepancy. Switchbacks on steep slopes (Figure \@ref(fig:proj-map-fig)c) are also a source of discrepancy outside of cutblocks. Overall, projections of distance to road, the forestry disturbance footprint, and the road disturbance footprint are more accurate than projections of road density and road presence (Figure \@ref(fig:aspat-perf-fig)), suggesting that these measures are easier to project. Performance differences among low and high density method variants are larger than differences among projection algorithms, and all road network projection method variants represent an improvement over the "cutblocks only" scenario where cutblocks were the only disturbance considered.

```{r get-data}
# load csv
meanTable <- read.csv(here(data_path_drvd, "mean_table.csv"))
matchData <- read.csv(here(data_path_drvd, "agree_table.csv"))
meanTableRealCuts <- read.csv(here(data_path_drvd,"../TSA27_real_cuts",
                                   "mean_table.csv"))

matchDataRealCuts <- read.csv(here(data_path_drvd,"../TSA27_real_cuts",
                                   "agree_table.csv"))

```

```{r aspat-perf-fig, fig.height=4, fig.width=fig_widths["two"], fig.cap="Proportional difference of projected mean from observed mean road metrics using different projection method variants within cutblocks, outside cutblocks, and overall (1 ha cost raster). Values greater than zero indicate overprojection and negative values indicate underprojection. Cutblocks not accessible via the observed road network were excluded from analysis. Performance varies among metrics (columns), projection method variants (colours), and within and outside cutblocks."}
# organize data for ggplot
doAspatPlot(meanTableRealCuts)

# save runTimes for later comparison
ilcp_time <- meanTableRealCuts %>% 
  filter(method == "ilcp", areaMean == "overall") %>% 
  pull(runTime) %>% round(2)

mst_time <- meanTableRealCuts %>%
  filter(method == "mst", areaMean == "overall",
         sampleType == "regular", sampleDens == "high sample density") %>% 
  pull(runTime) %>% round(2) %>% `*`(60)

```

```{r proj-map-fig, fig.height=9, fig.width=fig_widths["two"], fig.cap="Comparison of the minimum spanning tree projection with regular high density sampling to the observed road network. The main map shows observed distance to the nearest road minus the projected distance. Insets highlight areas of interest with satellite imagery (Google 2022) for context: (a) Projected and observed road networks follow valleys but projected roads cross valley bottoms more frequently; (b) some open areas are misidentified as cutblocks; (c) projected methods do no mimic observed switchbacks."}

knitr::include_graphics(here("analysis/figures/Figure4_map_update.png"))

```

```{r spat-perf-fig, fig.height=4.5, fig.width=fig_widths["two"], fig.cap="Aspatial variation of in performance among projection method variants (1 ha cost raster). F-measure is the harmonic mean of precision and sensitivity, precision is the proportion of predicted pixels that were observed and sensitivity is the proportion of observed pixels that were correctly predicted. Values closer to one indicate better performance. Cutblocks not accessible via the observed road network were excluded from analysis."}
perf_tbl <- doSpatPerf(matchDataRealCuts)
perf_tbl_rng <- perf_tbl %>% group_by(metric) %>% 
  summarise(rng_F = range(F_measure, na.rm = TRUE) %>% round(3) %>% paste0(collapse = " - "), .groups = "drop") %>% pull(rng_F, name = metric)

doSpatPlot(perf_tbl)

```

As expected, none of the projection methods yield accurate spatial projections of road presence (i.e. the exact locations of roads) (F-Measure: `r perf_tbl_rng["Road presence"]`). Neither do any of the methods provide better information about the exact location of the forestry disturbance footprint than the locations of cutblocks only (F-Measure: `r perf_tbl_rng["Forestry disturbance\nfootprint"]`). All methods provide comparably good projections of the road disturbance footprint (F-Measure: `r perf_tbl_rng["Road disturbance\nfootprint"]`), though higher sampling densities yield fewer false negatives and more false positives (Figure \@ref(fig:spat-perf-fig)). The ILCP projection method had comparable performance to the MST projection method with the same sampling strategy. The ILCP method was faster to compute however, with a run time of `r ilcp_time` minutes compared to `r mst_time` minutes for the MST method.

<!-- TO DO: Sarah figure out why `r ilcp_time` and `r mst_time` are coming out as NA, and how to fix that.-->

# Discussion

Despite a rapidly growing body of evidence of complex and varied impacts of road networks on wildlife and other values, and increasing use of spatial stochastic models for forecasting impacts of forest disturbance across regions, very few spatial stochastic projections of forest disturbance dynamics have included road network projections, in part because tools suited for this purpose have not been available. Hardy et al. [-@hardy_forest_2019; -@hardy_landis-ii_2023] partially addressed this need with an extension that can be integrated with other components of the Landis-II modelling framework [e.g. @labadie_global_2023]. Our implementations of simple iterative least cost path and minimum spanning tree methods [@lochhead_demo_2018; @lochhead_linking_2022] in the open source R package `roads` [@endicott_roads_2023] provide a complementary and comparable alternative to Hardy's method that can be easily integrated into R workflows and modelling frameworks used for forecasting forest change in Canada and elsewhere [e.g. @barros_empowering_2023; @daniel_state-and-transition_2016].

We evaluated performance of these algorithms in a topographically complex region of British Columbia where we anticipated projection of forest road network patterns would be challenging, using a very simple cost surface model. Thus, we were not surprised to see less accurate projections of road density and presence than in less mountainous regions of eastern Canada with more careful accounting for the cost of water crossings [@hardy_landis-ii_2023]. Water crossing behaviour in Revelstoke could be improved with a more detailed high resolution cost surface, but none of these simple algorithms will project switchbacks on steep slopes that are characteristic of forest roads in mountains. A related fundamental limitation is that none of these algorithms can project road tortuosity within raster cells, so in complex landscapes projections of road density become less accurate as raster cell resolution increases.

Aspatial metrics of overall projection accuracy can be difficult to interpret. To more deeply understand variation in the behaviour of road network projection algorithms we found it helpful to distinguish between performance within cutblocks and outside of them, and to examine spatial variation in discrepancies. Examination of spatial mismatch between observed and projected roads highlighted errors in our input data, and removing mapped cutblocks without observed access roads from our analysis helped resolve the apparently contradictory results. These input data errors are not unique to our study area; there is considerable variation in the consistency and accuracy of available resource road information across Canada and elsewhere [@poley_identifying_2022; @ministry_of_forests_resource_nodate] that users should keep in mind interpreting discrepancies between observed and projected road networks.

Outside cutblocks, we saw very little variation in performance among projection method variants. All were somewhat better than nothing, but the improvement was small because in this landscape new landings were fairly close to existing roads. Outside cutblocks our ILCP algorithm is similar to Hardy's algorithm, so we expect little difference in behaviour where targets are far from existing roads. Within cutblocks, the density of landing points had a much larger impact on performance than the choice of DCLP or MST algorthm. The Hardy algorithm most accurately projected high road density within blocks, but examination of spatial patterns clarified that the projected tortuousity is quite different from observed switchbacks, and may be an artefact of searching for nearest destinations \>200 m away on a 100 m grid. One could increase the density of landing points in the DCLP/MST projections to match the observed high density of roads within cutblocks, but if realistic switchbacks in mountainous terrain is a key goal then none of these algorithms are sufficient.

Simple algorithms can recreate some aspects of observed road networks but not others, and more complex realistic algorithms are more costly to develop and use. Before investing in additional complexity, it is important to recognize that adequacy depends on the goal. For some purposes, projections from relatively crude cost models and simple algorithms may be adequate. For example, models of caribou movement often include distance to roads as a predictor [e.g. @labadie_global_2023], and a combined metric of buffered anthropogenic disturbance best explains variation in boreal caribou demographic rates among ranges [@johnson_science_2020]. In our example landscape, projections of size disturbance footprints (500 m and 1km buffer) and distance to road are reasonably accurate, and for wildlife response models informed by these measures our somewhat crude road projections are likely good enough.

There are many metrics of connectivity and fragmentation [@francis_routledge_2021] we did not consider in this paper. In general, performance will vary among metrics, and it is difficult to determine what is good enough without reference to particular circumstances (i.e. objectives, species, landscapes). The most informative performance metrics will be those most closely linked to outcomes of interest. For example, where the outcome of interest is space use or connectivity projected from more [e.g. @whittington_towns_2022; @labadie_global_2023] or less [e.g. @hughes_comparison_2023; @diniz_landscape_2020] species-specific movement models it may be helpful to test sensitivity of these models to the difference between observed and retrospectively projected roads. When constructing new wildlife response models intended for projection, it may also be helpful to select metrics such as distance to road or buffered disturbance footprint that are more easily projectable [@bodner_bridging_2021]. Rather than adding additional performance metrics to this paper, we have focused our efforts on development of an open source R package [@endicott_roads_2023] and workflows [@endicott2024] that we hope will help enable users to devise performance tests appropriate to their particular circumstances and goals. We recognize that acquiring data to retrospectively project roads can be challenging, so we also provide output maps [@endicott2024a] and an example script (analysis/scripts/4_calc_any_metric.R) to enable calculation of alternative performance metrics of interest for our Revelstoke example, along with a data preparation script (analysis/scripts/1_prepareData.R) that could be modified to extract required input data for other areas in British Columbia.

In this paper our focus is tools for integrating forest roads into projections of the cumulative effects of disturbance on wildlife. However, we note there are other possible uses for these road network projection methods. Cost minimizing methods are not suitable for projecting development of seismic lines (Figure \@ref(fig:ftNelson)), but for other circumstances such as mine access where the objective is to minimize the cost of reaching a target location these methods may be applicable. Lochhead et al. [-@lochhead_linking_2022] used the least cost path algorithm to reconstruct the likely history of road network development in a case where harvest dates were known but road construction dates were not. In principle, these algorithms could also be used to link disconnected road segments into a network, but local route finding algorithms [@roussel_vectorial_2023] that do not require construction of large graphs are better suited to this purpose. More obviously, spatial stochastic models are used to project impacts of disturbance on a variety of values other than wildlife [@albrich_simulating_2020; @hof_editorial_2021; @sturtevant_understanding_2021]. It would also be interesting to account for persistent impacts of resource roads on vegetation, productivity and carbon sequestration [@braham_characterization_2023].

```{=html}
<!-- The model will simply build the roads in the least costly locations based on the cost surface, however often in the real world, roads must be planned around ownership and administrative boundaries. In BC, forestry roads are developed by forest licensees under a timber harvesting permit (Government of British Columbia, 2021c). -->

Discuss challenges on large landscapes & solutions...
```
# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
