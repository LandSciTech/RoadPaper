---
title: "Implementation and assessment of tools for integrating forest roads into projections of the cumulative effects of disturbance on wildlife"
author:
  - name: Josie Hughes
    email: josie.hughes@ec.gc.ca
    institute: [ECCC]
    correspondence: true
    equal_contributor: "yes"
    orcid_id: 0000-0001-7875-9015
  - name: Sarah Endicott
    email: sarah.endicott@ec.gc.ca
    institute: [ECCC]
    correspondence: false
    equal_contributor: "yes"
  - name: David Lapins
    email: david.lapins@pc.gc.ca
    institute: [ECCC]
    correspondence: false
  - name: Gregory Paradis
    email: gregory.paradis@ubc.ca
    institute: [UBC]
    correspondence: false
  - name: Kyle Lochhead
    email: Kyle.Lochhead@gov.bc.ca
    institute: [FLNR]
    correspondence: false

institute:
  - ECCC: Environment and Climate Change Canada 
  - FLNR: British Columbia Ministry of Forests 
  - UBC: University of British Columbia 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      number_sections: no
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: Roads.bib
csl: "../templates/canadian-journal-of-forest-research.csl" # Insert path for the bib-style
abstract: |
  Despite a rapidly growing body of evidence of complex and varied impacts of road networks on wildlife and other values, and increasing use of spatial stochastic models for forecasting impacts of forest disturbance across regions, very few spatial stochastic projections of forest disturbance dynamics have included road network projections, in part because tools suited for this purpose have not been available. Hardy et al. [-@hardy_landis-ii_2023] partially addressed this need with a Landis-II extension. As a complementary and comparable alternative, we provide implementations of simple iterative least cost path and minimum spanning tree methods in an open source R package that can be easily integrated into R workflows and modelling frameworks used for forecasting forest change in Canada and elsewhere. Comparison of these methods in a mountainous region of British Columbia clarifies that performance is adequate according to some metrics but not others, that aspatial performance metrics obscure important differences in alorithm behaviour within and outside cutblocks, and that none of these algorithms mimic switchbacks in steep terrain. Method assessment is complicated by errors in available in cutblock and forest road data. Simple iterative least cost path road network simulation methods may be adequate for projecting important impacts on wildlife across large areas, and we hope that more easily useable open source implementations will help integrate resource roads into forest change projections.
keywords: |
  keyword 1; keyword 2; keyword 3
editor_options: 
  chunk_output_type: inline
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

<!-- Link to data here: https://drive.google.com/file/d/179lw6MPK4l3xGmded9kofzJkB6VlJVb9/view?usp=sharing -->

```{=html}
<!-- TO DO CJFR guidelines to note:
* 6000 words, 50 references - need to remove ~30 refs
* abstract 200 words
* page #s
* double spacing
* affiliation - insitution, city, prov, country
* CMJE definition of authorship - need CRedit author contribution statement
* need funding statement, data availability statement, competing interests
* review figure guidance
-->
```
Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Introduction

The impacts of roads on wildlife are complex and varied. Mortality risk and stress on or near roads can be elevated due to vehicle collisions, hunting pressure, predation, noise and other stressors, but roads can also provide food, facilitate movement, and provide refuge [@hill_review_2021; @trombulak_review_2000; @fahrig_effects_2009]. In Canadian forests, there is ample evidence of linear features attracting predators such as bears (*Ursus americanus*, *Ursus arctos*) and wolves (*Canis lupus*) seeking food or easy movement, while repelling prey such as woodland caribou (*Rangifer tarandus caribou*) and moose (*Alces americanus*) [@dickie_corridors_2020; @polfus_identifying_2011; @mumma_predation_2018; @beauchesne_disentangling_2013; @leblond_avoidance_2013; @laurian_interactions_2012;@st-pierre_stairway_2022]; there is also evidence of predators avoiding features heavily used by humans [@muhly_human_2011; @whittington_towns_2022; @proctor_effects_2020]. Changes in mortality risks, habitat quality, and connectivity associated with anthropogenic disturbance can in turn alter use and movement patterns [@tucker_moving_2018; @apps_factors_2006; @proctor_effects_2020], demography and population viability [@johnson_science_2020; @decesare_linking_2014; @barrientos_lost_2021; @apps_spatial_2013; @pinard_calving_2012; @fahrig_effects_2009; @lochhead_linking_2022; @apps_spatial_2013; @proctor_effects_2020], and genetics [@habrich_varying_2021]. Roads can also facilitate spread of invasive species [@riitters_landscape_2017], and enable other development activities [@johnson_growth-inducing_2020]. Impacts on wildlife persist after roads are no longer driveable as they continue to be used by wildlife and soil compaction impedes vegetation recovery [@st-pierre_drivers_2021; @lacerte_determinants_2021]. Measures of road impacts are important for informing wildlife management decisions, and there is a need to include roads in ecological forecasting models.

Increasingly rapid environmental change, improvements in available cyberinfrastructure, and development of open source data, tools and methods have contributed to growing interest in ecological forecasting models [@bodner_bridging_2021; @dietze_ecological_2017; @mcintire_perfict_2022]. In particular, forest landscape models that can account for harvest, fire, and other disturbances are widely and increasingly used to project the cumulative effects of climate change and forest management [@petter_how_2020; @albrich_simulating_2020; @hof_editorial_2021; @tremblay_harvesting_2018; @snell_importance_2018; @daniel_incorporating_2017; @stewart_climate-informed_2023; @micheletti_assessing_2021; @leblond_there_2022; @bouderbala_long-term_2022; @barros_empowering_2023; @labadie_global_2023], building on a rich history of spatial-stochastic models of forest growth and succession following disturbance [@sturtevant_understanding_2021]. Despite the importance of roads for wildlife, very few of these projections have included road networks. For example, in a recent collection of articles focused on "Using Landscape Simulation Models to Help Balance Conflicting Goals in Changing Forests" [@hof_editorial_2021], only one includes a road projection [@leston_quantifying_2020]. In the absence of road projection methods, researchers are left to conservatively infer the amount and randomly assign the location of roaded areas [@johnson_witnessing_2015].

While road projection tools are not typically used in forest landscape models, methods have been developed to support harvest planning [@anderson_projecting_2004; @clark_three-stage_2000; @dean_finding_1997; @epstein_combinatorial_2006; @meignan_heuristic_2012; @stuckelberger_improved_2007], and some forest management planning software suites [e.g. @remsoft_remsoft_nodate; @spatial_planning_systems_patchworks_nodate] include road network projection tools. These have occasionally been incorporated into forest landscape models [e.g. @leston_quantifying_2020] but they were not designed for that purpose. The algorithms contained in proprietary closed-source software are difficult to  fully integrate into models that include stochastic disturbances [@sturtevant_understanding_2021; @de_pellegrin_llorente_recognizing_2017] used for research because costs of licensing are generally prohibitive, deploying large commercial software suites designed for desktops to cloud or high performance computing resources is difficult or impossible, and closed-source software is often not sufficiently transparent for research. The level of detail required to parameterize forest management planning tools is also often difficult to obtain at landscape scales. Harvest road planning methods and tools [e.g. @anderson_projecting_2004; @clark_three-stage_2000; @dean_finding_1997; @epstein_combinatorial_2006; @meignan_heuristic_2012; @stuckelberger_improved_2007; @remsoft_remsoft_nodate; @spatial_planning_systems_patchworks_nodate] may produce more accurate road projections but the cost of preparing and running them can be prohibitive in contexts where a rougher approximation of road locations may suffice. There is a need for simple open-source road network projection tools that can be integrated into the open modular platforms that are used for large-scale stochastic landscape simulations [@scheller_design_2007; @barros_empowering_2023; @daniel_state-and-transition_2016].

Geographic route finding algorithms often draw from a larger body of work on methods for finding paths among points that minimize some measure of cost [@deo_graph_2016]. General-purpose open source tools for graph analysis [e.g. @igraph_core_team_igraph_nodate] include methods for building graphs from adjacency matrices, finding “least cost paths” between pairs of points, and finding a least cost network of routes (i.e. a minimum spanning tree) that connects a larger set of points [@deo_graph_2016]. More domain-specific tools [e.g. @van_etten_r_2017] can help make these general-purpose tools easier to use and apply in specific contexts. Promising simple graph-based options for integrating forest road network projections into large scale stochastic projections of forest change include an iterative least cost path method developed by Hardy et al [-@hardy_forest_2019; -@hardy_landis-ii_2023], and least cost path and minimum spanning tree algorithms used to project roads and reconstruct development history in British Columbia [@lochhead_demo_2018; @lochhead_linking_2022]. The former method is available as QGIS and Landis-II extensions, and the latter is embedded in a larger open source modelling project that is specific to British Columbia [@muhly_castor_nodate]. Hardy's tool is designed for integration with other components of the Landis-II modelling framework [@scheller_design_2007; @labadie_global_2023], but none of the existing implementations can be easily integrated into the full variety of modelling frameworks used for forecasting forest change in Canada and elsewhere [e.g. @barros_empowering_2023; @daniel_state-and-transition_2016].

We acknowledge that using graph analysis methods to simulate roads is not new, and that other variants of iterative least cost path (or source-to-closest-target) and minimum spanning tree algorithms have been proposed and explored [@picard_finding_2006;@anderson_projecting_2004;@stuckelberger_improved_2007;@clark_three-stage_2000]. Anderson and Nelson’s (2004) more complex iterative least cost path method allows for consideration of horizontal and vertical alignment, turn radius and junction angles, and switchback spacing. However, constructing and analyzing graphs for large landscapes is memory intensive and computationally demanding.  We focus here on assessing the adequacy of methods that minimize memory and computational requirements by setting construction costs on a regular isotropic graph from a single input raster. If these simple algorithms can produce adequate outcomes for landscape-level stochastic ecological forecasting then the additional burden of more complex realistic algorithms is not warranted in that context. Both Hardy et al. [-@hardy_forest_2019; -@hardy_landis-ii_2023] and Lochhead et al. [-@lochhead_linking_2022] calculate the cost of constructing a road from one raster pixel to another (represented as graph edge weights) from a single user-supplied cost surface raster that can vary with attributes that alter construction costs such as slope and the presence of water. Here we assess this approach and also propose and assess a simplified method for penalizing steep grades [as suggested by @anderson_projecting_2004] that does not incur the additional computational costs associated with other aspects of their more complex method.

To help address the need for adequately accurate forest road network projection tools that can be easily integrated into stochastic models of forest change we implemented simple iterative least cost path and minimum spanning tree methods [@lochhead_demo_2018; @lochhead_linking_2022] and a simplified version of the grade penalty approach suggested by Anderson and Nelson [-@anderson_projecting_2004] in an open source R package. Our intention is to produce outputs comparable to Hardy et al. [-@hardy_forest_2019; -@hardy_landis-ii_2023] with a tool that can be used in modelling contexts outside of QGIS/Landis, and can serve as a more easily modifiable starting point for further refinement and development. We compared the ability of these methods and Hardy's method [-@hardy_forest_2019; -@hardy_landis-ii_2023] to reconstruct observed forest road network development since 1990 in a mountainous region of British Columbia. The adequacy of a road network projection method depends on the purpose of the projection, so it is important to select performance metrics that reflect the purpose. Given our interest in projecting impacts on wildlife we focus on several common predictors of the impacts of roads on wildlife, including distance to roads [@labadie_global_2023], buffered disturbance footprint [@johnson_science_2020; @ibisch_global_2016; @lochhead_linking_2022; @polfus_identifying_2011; @labadie_global_2023; @stewart_climate-informed_2023], and road density [@apps_factors_2006; @apps_spatial_2013; @serrouya_time_2017].

We expect these simple graph-based road projection methods to represent a reasonable compromise between computational cost and realism for stochastic projections on large landscapes, and we expect our simplified method for penalizing steep grades to yield more realistic road networks in steep terrain. We do not have a similarly strong hypothesis about whether minimimum spanning tree  projections are likely to be more or less realistic than interative least cost path projections. If designers of real roads take a larger view to accessing multiple sites at the lowest cost we might expect minimum spanning tree algorithms to yield more realistic networks. However, real road networks are built over time, and it is not necessarily true that they designed to minimize overall cost, so it is possible that larger more costly road networks built by iterative least-cost path algorithms will be more realistic.

```{=html}
<!-- TO DO:
- more thorough review of SMC & grizzly papers
- summarize road metric types used in cited papers more systematically.
-->
```
```{=html}
<!--
See notes here:
https://docs.google.com/document/d/1UQ_iC69QX0qX86NM6zSSQ036CgslN-uCXCdBY-4nU5M/edit
Effects of roads on wildlife include increased mortality from various types of encounters with humans, alterations in behaviour and interactions among predators and prey, and spread of invasive species (Trombulak and Frissel 2001). In boreal forests and coniferous forests of the Columbia and Rocky mountains, notable impacts of logging roads include facilitation of movement by wolves (Mumma et al. 2018; Dickie et al. 2020), attraction of bears to roadside food resources (Roever et al. 2010; Bastille-Rousseau et al. 2011; Dickie et al. 2020), increased mortality caused by humans near roads and trails (Roever et al. 2010), and avoidance by ungulates (Laurian et al. 2015; Dickie et al. 2020). Forest dwelling boreal woodland and mountain caribou avoid roads leading to a loss of available habitat (Polfus et al. 2011; Dickie et al. 2020), and suffer increased mortality near roads (Bastille-Rousseau et al. 2011; Mumma et al. 2018). At a range scale, survival and recruitment of boreal caribou declines with anthropogenic disturbance (Johnson et al. 2020). Eight herds of Southern Mountain Caribou have been extirpated or likely extirpated, and remaining herds are considered Endangered by COSEWIC  and listed as threatened under the Canadian Species at Risk Act (SARA) (Palm et al. 2019). Most boreal caribou populations with ranges that include intensive forest management activity are not self-sustaining (ECCC 2011; Johnson et al. 2020), and boreal caribou are also listed as threatened under SARA.

Nonlinear responses of elk to road density (Frair et al. 2008). Black bear responses to roads vary with road type (Zeller et al. 2020), and selection for roadside vegetation can increase neonatal boreal woodland caribou mortality in areas near roads . 
For more careful reading: Flyal et al. 2019; Jaeger et al. 2005; Laurance et al. 2014; Psaralexi et al. 2017; Apps et al 2014; Beyer et al. 2014; Blagdon and Johnson 2021; Suzuki and Parker 2016; Fahrig and Rytwinski 2009; Coffin et al. 2021; Crist et al. 2005; Grantham et al. 2020;Johnson et al. 2019; Meijer et al. 2018; Langeveld et al. 2009

<!-- value of roadless areas: [@ibisch_a_2016; @talty_conservation_2020; @psaralexi_importance_2017] -->

<!-- forest mgmt planning models: [@depellegrinllorente_recognizing_2017] -->

<!-- other of interest: caribou habitat metric [@whitman_a_2017] -->

<!-- Resource extraction, such as forest harvesting, is the main driver of road construction in much of Canada's forested area. In British Columbia, over 600 000 kilometers of resource roads make up the vast majority of the province's total road network (83%) (Environmental Reporting BC, 2018; Forest Practices Board, 2015). Over 75% of resource roads in the province were built by the forest industry (Forest Practices Board, 2015). -->

<!-- Forest simulation models generally either fall into two categories: deterministic and stochastic (Boychuk et al., 2009; Helmes & Stockbridge, 2011). -->

-->
```
# Methods

## Study Area and Data

We chose the Revelstoke timber supply area (TSA 27) in British Columbia, Canada as an assessment area because it is mountainous (Figure \@ref(fig:study-area)), containing approximately 38% non-forested land [@british_columbia_ministry_of_forests_revelstoke_2022] where road building is difficult or impossible. Thus, the area provides opportunities to observe the behaviour of road projection algorithms in steep complex terrain. Forestry is the dominant resource extraction activity and much of the road network was built to access forest harvest cutblocks, allowing projection of the road network from historic forest harvest data. The Revelstoke TSA includes portions of the Monashee and Selkirk mountain ranges, and is bisected by the Columbia River. At low to mid-elevations, forests of the interior cedar-hemlock biogeoclimatic zone [@british_columbia_ministry_of_forests_and_range_biogeoclimatic_nodate] include remnants of rare old growth inland temperate rainforest [@government_of_canada_parks_canada_agency_old_2017]. At higher elevations, forests are dominated by Englemann spruce and subalpine fir [@british_columbia_ministry_of_forests_and_range_biogeoclimatic_nodate]. The area is within the ancestral territories of the Ktunaxa Nation, Secwepemc Nation, Syilx and Sinixt [@british_columbia_ministry_of_forests_revelstoke_2022]. Two of six southern mountain woodland caribou herds in the area have been extirpated, and the remaining herds are considered Endangered by the Committee on the Status of Endangered Wildlife in Canada and listed as threatened under the Canadian Species at Risk Act [@palm_long_2020; @british_columbia_ministry_of_forests_revelstoke_2022; @environment_canada_recovery_2014]. Mountain caribou avoid roads leading to a loss of available habitat [@polfus_identifying_2011; @apps_factors_2006], suffer increased mortality near roads [@apps_spatial_2013], and decline in abundance as the footprint of roads and cutblocks increases [@lochhead_linking_2022]. Roads also alter grizzly habitat use, home range selection, movements, population fragmentation, survival, reproductive rates, population density, trends, and conservation status [@proctor_effects_2020].

```{=html}
<!--        TO DO: consider these comments from Kyle: Need a description about road development. In BC, forestry roads are developed by forest licensees under a timber harvesting permit. Various considerations go into road development including soils, grade, and economics. What type/classification of roads are you looking at (primitive roads, paved roads, etc). What’s the maximum grade? ---can find a lot of this verbiage in the Interior Appraisal Manual. How are they maintained – do they last forever -see Auditor General Report 
•        How much of the Revelstoke TSA overlaps with caribou range? Elevation? Climate? Flora/Fauna?
•        Maybe add a table of descriptive statistics presenting information about roads in the Revelstoke TSA and the other TSAs you mention? By Caribou Range? – road density, road length, cutblock area, cutblock density, etc
-->
```

```{r setup2}
library(sf)
library(ggplot2)
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
library(ggpubr)
library(MetBrewer)
library(here)
library(tmap)

#devtools::install_deps(here()) #try this if the next line is giving trouble.
devtools::load_all(here())

#set paths
data_path_raw <- "analysis/data/raw_data/"
data_path_drvd <- "analysis/data/derived_data/TSA27_real_cuts"

pal_nm <- "Redon"

fig_widths <- c(min = 1.18, single = 3.543, mid = 5.51, two = 7.48)
```

<!---BLOCK_MULTICOL_START--->

```{r prepStudyArea, cache=TRUE}

tsaBoundary <- read_sf(here(data_path_raw, "tsa27_boundaries.gpkg"))
#cost surface raster layer
tsaCost <- terra::rast(here(data_path_drvd, "old cost/input_cost.tif"))
dem <- terra::rast(here(data_path_drvd, "dem/input_cost.tif"))

#tsaCost[tsaCost==65000]=NA
dem[dem==-65000]=NA

tsaCost <- terra::mask(tsaCost, terra::vect(tsaBoundary))
dem <- terra::mask(dem, terra::vect(tsaBoundary))

canada <- geodata::gadm("CAN", level = 1, path = here(data_path_raw))

canada <- canada %>% 
  st_as_sf() %>% 
  filter(COUNTRY == "Canada") %>% 
  st_transform(st_crs(tsaBoundary)) %>% 
  st_simplify(dTolerance = 10000)

canada_overlay <- tm_shape(canada, projection = "+proj=lcc +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs")+
  tm_borders(col="black")+
  tm_shape(st_buffer(tsaBoundary, 10000))+
  tm_polygons(border.col = met.brewer(pal_nm, 1), col = met.brewer(pal_nm, 1))+
  tm_layout(frame=TRUE)

tsa <- tm_shape(tsaCost, name = "Cost")+
  tm_raster(style = "cont", title = "Cost",palette="Greys")+
  tm_shape(st_union(tsaBoundary))+
  tm_borders(col = "black")+
  tm_compass(position = c(0.3, 0.11), size = 1)+
  tm_scale_bar(position = c("center", "bottom"), text.size = 1)+
  tm_layout(legend.position = c("left", "bottom"),
            legend.bg.color = "white")
  
vp <- grid::viewport(x=0.965, y=0.945, width = 0.35, height=0.2,
               just=c("right", "top"))

tmap_save(tsa, filename = here("analysis/figures/Figure1_StudyArea.png"),
  dpi = 600, insets_tm = canada_overlay, insets_vp = vp,
  height = 6*0.9, width = fig_widths["single"]*0.9, units = "in")

tsaDEM <- tm_shape(dem, name = "Elevation")+
  tm_raster(style = "cont", title = "Elevation",palette="Greys")+
  tm_shape(st_union(tsaBoundary))+
  tm_borders(col = "black")+
  tm_compass(position = c(0.3, 0.11), size = 1)+
  tm_scale_bar(position = c("center", "bottom"), text.size = 1)+
  tm_layout(legend.position = c("left", "bottom"),
            legend.bg.color = "white")

tmap_save(tsaDEM, filename = here("analysis/figures/Figure1_StudyAreaDEM.png"),
  dpi = 600, insets_vp = vp,
  height = 6*0.9, width = fig_widths["single"]*0.9, units = "in")

```

```{r study-area1, fig.cap= "see next fig"}

knitr::include_graphics(here("analysis/figures/Figure1_StudyArea.png"))

```
```{r study-area2}

knitr::include_graphics(here("analysis/figures/Figure1_StudyAreaDEM.png"))
```
<!---BLOCK_MULTICOL_STOP{widths: [3.6,3.6]}--->

```{r study-area, fig.cap="Road construction cost surface and an elevation surface used to calculate grade penalties. Costs are calculated using a simple model informed by slope and major barriers (Table 1) in the Revelstoke timber supply area in British Colombia, Canada. In both layers, pixels containing existing roads are assigned a value of 0."}

png::writePNG(array(0, dim = c(1,1,4)), here("analysis/figures/empty.png"))
knitr::include_graphics(here("analysis/figures/empty.png"))
```

Road network data was obtained by combining the digital road atlas [@data_bc_digital_2021] and forest tenure road [@british_columbia_ministry_of_forests_lands_natural_resource_operations_and_rural_development__flnrord_forest_2021] data sets for British Columbia. To avoid situations where the same road was included in both data sets with slightly different coordinates, we removed all roads from the digital road atlas that were within 50 m of forest tenure roads. The existing road network, used as the starting point for projections, was created by filtering out forest tenure roads with an award date greater than 1990. We assumed everything in the digital road atlas was built before 1990. Cutblock information was obtained from the Harvest Areas of BC (Consolidated Cutblocks) dataset [@government_of_british_columbia_harvested_2021], compiled from provincial Forest Cover, the RESULTS Reporting system, Forest Tenure applications, and satellite imagery using change detection processes. Forest harvest cutblocks with harvest years greater than 1990 were filtered and used as targets for the projections. We further filtered cutblocks that contain observed roads from those that do not to reduce errors associated with open areas that have been misidentified as cutblocks. Results including all cutblocks are also presented. 

Following the Interior Appraisal Manual of BC, we assume the base cost of construction per kilometer of road is a linear function of slope [@government_of_british_columbia_interior_2021], and that road construction across major water bodies is prohibitively expensive (Table \@ref(tab:cost-tbl)). Existing roads are assigned a construction cost of 0. We compare two different methods for integrating these costs into the cost of connections between adjacent raster cells. In the first method, the cost of the connection between two adjacent cells is simply the mean of a cost raster value at each of those cells, and we refer to it as the “simple cost” method. In the second method, we calculate the cost of a connection between neighbouring cells as a function of the elevation difference between the cells, using an elevation raster as input (Figure \@ref(fig:study-area)b). This second method allows us to penalize edge grade as suggested by Anderson and Nelson (2004), and we refer to it as the “grade penalty” method. The road construction cost and elevation rasters consist of 1.7 million pixels with a resolution of 1 ha. We examined sensitivity to our choice of resolution by comparing results from 1 ha and 100 ha cost rasters. We did not consider finer resolutions because stochastic forest landscape models typically simulate dynamics at resolutions >= 1 ha.

```{r cost-tbl}
tbl <- "Cost Type|Value ($ per km)|Source
Slope (%)|16178 + 504*slope|Interior appraisal manual
Major lakes|NA|Major water bodies of BC
Existing roads|0|Digital road atlas and forest tenure roads for BC
"
df <- read.delim(textConnection(tbl),header=FALSE,sep="|",strip.white=TRUE,stringsAsFactors=FALSE)
names(df) <- unname(as.list(df[1,]))
df <- df[-1,] # remove first row
row.names(df)<-NULL
knitr::kable(df, caption = "A simple model of road construction costs. In the “grade penalty” method, we assign grades >20% a more prohibitive cost of 65000.")
```

All data sets were accessed using the `bcdata` R package and filtered to the extent of the Revelstoke Timber Supply Area [@teucher_bcdata_2021]. These data sets are continuously updated so we have stored the versions used in our analysis in an Open Science Framework repository [@endicott_assessment_2024]. We were not granted permission to share the digital road atlas so it must be accessed from the B.C. Data Catalogue [@data_bc_digital_2021]. Scripts used for data acquisition and analysis associated with this paper are available on GitHub [@endicott_roadpaper_2024].

## Road Projection Methods

We focus on methods that link multiple target locations to an existing road network by finding minimum-cost locations for new roadways that link landings within harvest cutblocks (i.e., log decks) to the existing road network, described by Dean [-@dean_finding_1997] as the multiple target access problem (MTAP). Specifically, we compare iterative least cost path (ILCP) and minimum spanning tree approaches (MST) proposed by Lochhead et al [-@lochhead_demo_2018; -@lochhead_linking_2022] for solving the MTAP to another iterative least cost path method developed by Hardy [-@hardy_forest_2019; -@hardy_landis-ii_2023] (Figure \@ref(fig:proj-meth-fig)). We use the QGIS version of Hardy’s method (2019), which is easier for us to apply and does not differ substantially from the LANDIS extension (Hardy personal communication).

The ILCP approaches solve the MTAP by decomposing the problem into several smaller single target access problems (STAPs). For each landing target, the least cost path to the existing road network is solved using Dijkstra's shortest path algorithm [-@dijkstra_note_1959]. There are a variety of possible methods for building graphs, choosing branch locations, and ordering targets, and different methods will produce different networks [@anderson_projecting_2004;@hardy_forest_2019; @hardy_landis-ii_2023;@picard_finding_2006]. The iterative least cost path algorithm we use [@lochhead_demo_2018; @lochhead_linking_2022] is parameterized with a weighted graph wherein each node corresponds to a raster pixel representing one of three components of the potential forest road network: a landing, a point on an existing road, or an intermediate point that is a plausible location for road construction. Each node is connected with up to eight neighbours, and the cost of construction along edges is weighted by the distance to neighbouring nodes and the average of the cost raster value at the source and destination nodes, or a more complex function of the difference in elevation between the source and destination nodes (Table \@ref(tab:cost-tbl), Supplement A). Both the grade penalty and simple cost methods require construction of a simple regular isotropic graph from a single input grid, which is less computationally costly than more complex proposed methods for consideration of curvature and switchbacks [@stuckelberger_improved_2007;@anderson_projecting_2004]. We use a greedy heuristic method that starts with the landing nearest to an existing road, builds a least cost path from the landing to the nearest point on the existing road, and updates the existing road network and construction cost surface with each new road segment before moving on to the next nearest landing.

Hardy’s method [-@hardy_forest_2019; -@hardy_landis-ii_2023]  is similar to our simple cost ILCP method in that it breaks the MTAP down into many STAPs and finds the least cost path for each with the ordering of road construction determined by the Euclidean distance from the existing road network. A key difference is that Hardy uses the Dijkstra algorithm to solve a “single-source many-targets shortest path problem”, which is a special case of STAPs that finds the path between the harvested cell and one of multiple potential connection points on the road network. In contrast, our algorithm first finds the closest point on the road network to the selected landing point and then uses the Dijkstra algorithm to solve least cost path between the two. However, since the cost of construction on existing roads is zero we expect that in practice these two approaches are similar and the algorithm will select the least cost location for the road to connect to the existing road network. It is possible that a sub-optimal road connection location is chosen by our algorithm when the existing road network is not fully connected and the closest point is on an existing road fragment that is not connected to the optimal part of the road network. Within cutblocks, Hardy’s method iterates over each cell in the harvest area and builds a road if it is not within skidding distance of an existing road, while we create landing points to serve as target locations for road construction.

Minimum spanning trees (MST) can also be used to link landings and evaluate road branching opportunities [@picard_finding_2006; @clark_three-stage_2000]. MST algorithms do not require users to select the order in which landings are processed, but it remains necessary to select a set of points on the existing road network to include in the tree. The first step in our MST approach is to estimate the least cost paths that link each of the landings and the least cost paths that link each landing to the nearest point on the existing road network. These results are used to create a weighted graph wherein nodes are either landings or nearest points on the existing road network, and edge weights correspond to the total cost of the least cost path between pairs of nodes. The minimum spanning tree for this graph is solved using Kruskal's algorithm [-@kruskal_shortest_1956], which links all nodes with a tree that minimizes edge weights. This method differs from Clark et al. [-@clark_three-stage_2000] who used Euclidean distances for edge weights, and thus did not incorporate spatial variation in road construction costs.


```{=html}
<!--
TO DO: should this paragraph about speed and memory go in the results or discussion rather than methods?
-->
```

Note that the evolution of a road network over time can be modeled by iteratively applying any of the methods, but in this manuscript we focus on comparing outcomes of a single application of each of the methods to a network of forest roads developed since 1990.

To help make these road network projection methods more easily and widely useable, we implemented the ILCP and MST methods in the open source R package `roads` [@endicott_roads_2023]. The `roads` package is dependent on several other R packages that made this work possible, including, among others: `igraph` for calculating least cost paths and minimum spanning trees [@csardi_igraph_2006; @noauthor_igraph_2022], `terra` for manipulating spatial raster data [@hijmans_terra_2023], and `sf` for manipulating spatial vector data [@pebesma_simple_2018; @pebesma_sf_2022]. The package is available on CRAN (The Comprehensive R Archive Network) and the source code, tutorials and documentation are available on GitHub [@endicott_roads_2023].

## Comparison of Method Variants

The ILCP and MST methods connect landings within each cutblock to the existing road network, so an important first step is to select one or more landing locations in each block. We investigated the sensitivity of results to the pattern and density of landing locations by comparing results derived from the centroid of each cutblock to regular or randomly selected landing densities of 1 (low) and 10 (high) points per km^2^ (Figure \@ref(fig:proj-meth-fig)). We used default settings in the Hardy QGIS plugin except for skidding distance which was set to 200m. A skidding distance of 200 m corresponds to \~ 9 pts/km^2^. We compared two resolutions of the cost surface by aggregating the 1 ha resolution cost raster to a coarser 100 ha (1000 by 1000 m) resolution. In total, we compared 12 road projection method variants to a cutblocks only scenario with no projected roads (Table \@ref(tab:method-tbl)).

```{r method-tbl}
tbl2 <- "Projection method|Sample type|Sample density (pts/km^2^)|Resolutions
MST grade penalty & simple cost|Regular|1|1 & 100 ha
MST grade penalty & simple cost|Regular|10|1 & 100 ha
MST grade penalty & simple cost|Random|1|1 & 100 ha
MST grade penalty & simple cost|Random|10|1 & 100 ha
MST grade penalty & simple cost|Centroid|N/A|1 & 100 ha
ILCP grade penalty & simple cost|Regular|10|1 ha 
Hardy QGIS|N/A|~9|1 ha
Cutblocks only|N/A|N/A|1 ha

"
df2 <- read.delim(textConnection(tbl2),header=FALSE,sep="|",strip.white=TRUE,stringsAsFactors=FALSE)
names(df2) <- unname(as.list(df2[1,]))
df2 <- df2[-1,] # remove first row
row.names(df2)<-NULL
knitr::kable(df2, caption = "Road projection method variants. We examined sensitivity of minimimum spanning tree (MST) and iterative least cost path (ILCP) algorithms to the method of setting edge weights (grade penalty or simple cost), the placement of landings within cutblocks (regular or random), the density of landings within cutblocks, and map resolution.")
```

## Performance Metrics

To assess performance we calculated four characteristics of the projected and observed road networks that are relevant for wildlife: road density, measured as density of roads in meters per hectare (m/ha); distance to nearest road, measured as distance from each raster cell to the nearest road; road disturbance footprint, measured with a 1 km buffer around roads [@ibisch_global_2016]; and forestry disturbance footprint, measured with a 500 m buffer around roads and cutblocks. The forestry disturbance footprint is a variant of the buffered anthropogenic disturbance metric that is used as an indicator of boreal caribou critical habitat [@johnson_science_2020] and to quantify impacts of disturbance on Southern Mountain caribou [@lochhead_linking_2022; @polfus_identifying_2011]. The other metrics are also often used in studies of anthropogenic impacts on wildlife [e.g. @labadie_global_2023; @stewart_climate-informed_2023; @apps_factors_2006; @apps_spatial_2013; @serrouya_time_2017]. We also calculated road presence, measured as whether or not roads are present in each pixel, but we note that accurate projection of the exact locations of forest roads is not generally a requirement in stochastic ecological forecasting models wherein the exact locations of future disturbances are often not known. Forestry disturbance footprint and road density were calculated using the *disturbanceMetrics* and *rasterizeLineDensity* functions in the `caribouMetrics` R package [@hughes_cariboumetrics_2022]. Distance to nearest road was calculated using a fast parallel moving window method implemented in the *getDistFromSource* function of the `roads` package.

<!-- TO DO: Discuss why we do not calculate the 50m buffer metric used by Kyle for SMC. 50 m buffer is basically built in to the 100 m raster resolution. Road presence would be our closest equivalent measure - and we don't project that measure very well. -->

Aspatial performance of the projections was assessed by comparing projected and observed mean values of each road network characteristic across the timber supply area and within cutblocks. As an example, distance to roads within cutblocks is the average distance from non-road pixels within cutblocks to the nearest roads. Spatial performance was assessed in two different ways. First, difference maps were created by subtracting the projected distance to the nearest road from the observed in order to highlight discrepancies between the road networks. The observed and projected road networks were then overlaid on the difference maps and regions of major discrepancies were investigated using Google satellite imagery in QGIS. Second, performance according to the three binary metrics (road presence, road disturbance footprint, and forestry disturbance footprint) was assessed by categorizing pixels of a projected raster into 5 categories compared with the observed raster: pre-existing footprint; agree roadless, meaning that both projected and observed show no footprint; agree roaded, meaning that both projected and observed show new footprint; false positive, meaning the projection shows a footprint but no footprint was observed; and false negative, meaning the projection shows no footprint but a footprint was observed. These categories were summarized for each projection and characteristic and used to calculate sensitivity, precision and F-measure of each metric [@lee_prediction_2021]. Sensitivity, also known as recall, gives the proportion of the true positives that were projected, while precision gives the proportion of positives projected that are true. Sensitivity will be lower when observed roads are missed and precision will be lower when roads are projected that were not observed. F-measure attempts to balance sensitivity and precision to give an overall score.

# Results

According to all aspatial performance measures, the grade penalty method for setting edge weights yields better results than our simple cost methods (compare Figure \@ref(fig:aspat-perf-fig) and Figure B.1). We therefore recommend using the grade penalty method, and focus on further examining variation in performance among grade penalty method variants (Figure \@ref(fig:aspat-perf-fig)). The MST regular high density method yields the best projections of road density within cutblocks, and all MST variants yield comparably good projections outside cutblocks, so overall the MST regular high density variant most accurately projects road density. All MST variants yield better projections of the forestry disturbance footprint than the Hardy or ILCP methods, and the Hardy and MST regular high density methods yield comparably accurate projections of road presence and distance to road.

Maps (Figures \@ref(fig:proj-meth-fig) and \@ref(fig:proj-map-fig)) help clarify exactly how the projection methods differ from one another, and from real roads. Even in cases where the Hardy method and the grade penalty MST and ILCP methods project similar mean road densities within cutblocks, the Hardy method projects a distinctly different pattern of road tortuosity within cutblocks (Figure \@ref(fig:proj-meth-fig)). The grade penalty method improves realism by making roads follow elevation contours, but all these methods create dead ends, intersections, and abrupt turns that are avoided in the engineering of real roads in steep terrain (Figures \@ref(fig:proj-meth-fig) and \@ref(fig:proj-map-fig)c). Our projected roads also cross valley bottoms far more often than observed roads which often run parallel to one another on each side of rivers (Figure \@ref(fig:proj-map-fig)a), but this discrepancy could likely be remedied by better accounting for the costs of crossing streams, rivers and other wet areas in valley bottoms. Finally, it is important to note that some discrepancies between observed and projected road networks may be caused by errors in the observed data, such as cutblocks that do not exist (e.g. \@ref(fig:proj-map-fig)b). We omitted false cutblocks with no associated access roads from our analysis; failure to do this would distort results (Supplement C). 

Although some perform better than others, all these methods underproject road density, road presence and forestry disturbance footprint (Figure \@ref(fig:aspat-perf-fig)). In other words, these road network projection methods project fewer roads than we observe. Projections of distance to road, the forestry disturbance footprint, and the road disturbance footprint are more accurate than projections of road density and road presence (Figure \@ref(fig:aspat-perf-fig)), suggesting that these measures are easier to project. One reason for underprojection of road density is that all these methods generate straight road segments within pixels. As raster resolution increases, the discrepancy within pixels between real roads and straight projected segments increases, which explains why projections of road density are less accurate when the cost raster resolution is coarse (Figure D.1). In contrast, projections of the proportion of cells that contain roads is more accurate on a coarse raster (Figure D.1).

```{r get-data}
# load csv
meanTable <- read.csv(here(data_path_drvd,"../TSA27/dem", "mean_table.csv"))
matchData <- read.csv(here(data_path_drvd,"../TSA27/dem", "agree_table.csv"))
meanTableRealCuts <- read.csv(here(data_path_drvd,"../TSA27_real_cuts/dem",
                                   "mean_table.csv"))

matchDataRealCuts <- read.csv(here(data_path_drvd,"../TSA27_real_cuts/dem",
                                   "agree_table.csv"))

```

```{r aspat-perf-fig, fig.height=4, fig.width=fig_widths["two"], fig.cap="Proportional difference of projected mean from observed mean road metrics using different projection method variants within cutblocks, outside cutblocks, and overall (1 ha cost raster). Values greater than zero indicate overprojection and negative values indicate underprojection. Cutblocks not accessible via the observed road network were excluded from analysis. Performance varies among metrics (columns), projection method variants (colours), and within and outside cutblocks."}
# organize data for ggplot
doAspatPlot(meanTableRealCuts)
```


```{r, cache=TRUE}
# Example area for demonstrating different methods

library(dplyr)
library(sf)
library(roads)
library(terra)
library(tmap)
library(purrr)
library(caribouMetrics)
#library(pfocal)

# read in example area data
exRoads <- read_sf(here(data_path_drvd, "..", "testing_ex_roads.gpkg"))
tsb <- read_sf(here(data_path_drvd, "..", "testing_tsb.gpkg"))
cutblocks <- read_sf(here(data_path_drvd, "..", "testing_cutblocks.gpkg"))
tsaCost <- raster::raster(here(data_path_drvd, "..", "testing_cost.tif"))
dem <- raster::raster(here(data_path_drvd, "..", "testing_dem.tif"))
roads <- read_sf(here(data_path_drvd, "..", "testing_obs_roads.gpkg"))

# densities
high <- 0.00001
low <-  0.000001

sampleDens <- c(high, high, low)
sampleType <- c("regular","random","centroid")
paramTable <- tibble(sampleType, sampleDens,
                     method = "mst",
                     runTime = vector("list", length(sampleDens)),
                     output = vector("list", length(sampleDens)),
                     roadDisturbance = vector("list", length(sampleDens)),
                     roadDensity = vector("list", length(sampleDens)),
                     roadPresence = vector("list", length(sampleDens)),
                     distanceToRoad = vector("list", length(sampleDens)),
                     forestryDisturbance = vector("list", length(sampleDens))) %>%
  distinct()

simpleCostFn = function(x1,x2,...) (x1+x2)/2
paramTable$weightFunction = deparse1(simpleCostFn,collapse="\n")
paramTable$weightMethod = "simple cost"

paramTableDem = paramTable
paramTableDem$weightFunction = deparse1(slopePenaltyFn,collapse="\n")
paramTableDem$weightFunction = gsub("limitWeight = NA","limitWeight = 65000",paramTableDem$weightFunction,fixed=T)
paramTableDem$weightMethod = "grade penalty"

paramTableDem<- subset(paramTableDem,sampleType!="centroid")

# re-run projections for just the small area with different parameters
set.seed(4)
mstProj <- projectAll(tsbs = tsb, paramTable = paramTable,
                      weightRaster = tsaCost,
                      cutblocks = cutblocks,
                      existingRoads = exRoads,
                      fileLocation = here(data_path_drvd,"..", "for_fig"),
                      roadsInWeight = F)
set.seed(4)
ilcpProj <- projectAll(tsbs = tsb,
                       paramTable = paramTable %>%
                         filter(sampleType == "regular") %>%
                         mutate(method = "ilcp"),
                       weightRaster = tsaCost,
                       cutblocks = cutblocks,
                       existingRoads = exRoads,
                       fileLocation = here(data_path_drvd,"..", "for_fig"),
                       roadsInWeight = F)

# re-run projections for just the small area with different parameters
set.seed(4)
mstProjDem <- projectAll(tsbs = tsb, paramTable = paramTableDem,
                         weightRaster = dem,
                         cutblocks = cutblocks,
                         existingRoads = exRoads,
                         fileLocation = here(data_path_drvd,"..", "for_fig"),
                         roadsInWeight = F)
set.seed(4)
ilcpProjDem <- projectAll(tsbs = tsb,
                          paramTable = paramTableDem %>%
                            filter(sampleType == "regular") %>%
                            mutate(method = "ilcp"),
                          weightRaster = dem,
                          cutblocks = cutblocks,
                          existingRoads = exRoads,
                          fileLocation = here(data_path_drvd,"..", "for_fig"),
                          roadsInWeight = F)

terra::writeRaster(tsaCost, here(data_path_drvd,"..",  "for_fig","HardyQGISTestweight.tif"),overwrite=T)

allProj <- bind_rows(mstProj, ilcpProj, mstProjDem, ilcpProjDem) %>%
  arrange(weightMethod,desc(sampleType), sampleDens)

# add Hardy QGIS results for the same area

allProj <- bind_rows(
  allProj,
  tibble(sampleType = "", sampleDens = 0, method = "Hardy QGIS",
         output = list(here(data_path_drvd,"..", "for_fig",
                            "HardyQGISTest.gpkg")))) %>%
  mutate(mapTitle =  paste(ifelse(is.na(weightMethod), "", weightMethod),
                           ifelse(method == "mst", "MST",
                                  ifelse(method == "ilcp", "ILCP", method)),
                           sampleType) %>%
           trimws())

# add extra row for legend
allProj <- bind_rows(allProj,
                     slice(allProj, 1))


allMaps <- purrr::map(
  1:nrow(allProj),
  ~ qtm(cutblocks, borders = "#92c5de", fill="#92c5de", borders.lwd = 1,)+
    qtm(rast(here(gsub(".gpkg","weight.tif",allProj$output[[.x]],fixed=T))),
        raster.style = "cont", raster.palette = "Greys",
        raster.alpha = 0.25, raster.title = NA, raster.legend.show = FALSE)+
    qtm(roads, lines.col = "#0571b0", lines.lwd = 2,lines.lty="solid")+
    qtm(read_sf(here(allProj$output[[.x]])), lines.col = "#ca0020", lines.lwd = 2)+
    qtm(exRoads, lines.col = "black", lines.lwd = 2)+
    tm_layout(legend.show = .x == nrow(allProj),
              legend.only = .x == nrow(allProj),
              main.title = allProj$mapTitle[[.x]],
              main.title.size = 0.75))

allMaps[[nrow(allProj)]] <- allMaps[[nrow(allProj)]]+
  tm_add_legend(type = "fill",
                labels = c("low", "med", "high"),
                col = c("grey99", "grey87", "grey75"),
                border.col= c("grey99", "grey87", "grey75"),
                title = "weightRaster")+
  tm_add_legend(type = "line",
                labels = c("Existing roads", "Projected roads", "Observed roads"),
                col = c("black", "#ca0020", "#0571b0"),lty=c("solid","solid","solid"))+
  tm_add_legend(type = "fill",
                labels = "Cutblocks",
                col = "#92c5de", border.col ="#92c5de")+
  tm_layout(legend.only = TRUE, legend.position = c("center", "center"))

tmap_save(tmap_arrange(allMaps, ncol = 3),
          here("analysis/figures/projection_methods_figure.png"),
          dpi = 300, height = 8, width = fig_widths["two"])
```

```{r proj-meth-fig, fig.cap="Comparison of road projection method variants (Table 2). The large four sided cutblock in the top right was added to more clearly show algorithm behaviour within cutblocks.The grade penalty method for setting edge weights (top row) encourages roads to follow slope contours, and yields fewer obviously unrealistic 90 degree turns in steep terrain than our simple cost method (middle row). Selecting a single landing at the centroid of each cutblock (bottom left) creates too few roads within cutblocks. In this 1 ha resolution example the Hardy QGIS plugin (bottom middle) creates more curved roads than our simple cost method (middle row), and does not follow slope contours like the grade penalty method (top row). Landing density is high for all except the centroid and Hardy variants."}
knitr::include_graphics(here("analysis/figures/projection_methods_figure.png"))
```

```{r proj-map-fig, fig.height=9, fig.width=fig_widths["two"], fig.cap="Comparison of the minimum spanning tree projection with regular high density sampling to the observed road network. The main map shows observed distance to the nearest road minus the projected distance. Insets highlight areas of interest with satellite imagery (Google 2022) for context: (a) Projected and observed road networks follow valleys but projected roads cross valley bottoms more frequently; (b) some open areas are misidentified as cutblocks; (c) projected roads follow contours but do not avoid turns and dead ends like observed switchbacks."}

knitr::include_graphics(here("analysis/figures/Figure4_map_update.png"))

```

```{r spat-perf-fig, fig.height=4.5, fig.width=fig_widths["two"], fig.cap="Variation in spatial performance among projection method variants (1 ha cost raster). F-measure is the harmonic mean of precision and sensitivity, precision is the proportion of predicted pixels that were observed and sensitivity is the proportion of observed pixels that were correctly predicted. Values closer to one indicate better performance. Cutblocks not accessible via the observed road network were excluded from analysis."}
perf_tbl <- doSpatPerf(matchDataRealCuts)
perf_tbl_rng <- perf_tbl %>% group_by(metric) %>% 
  summarise(rng_F = range(F_measure, na.rm = TRUE) %>% round(3) %>% paste0(collapse = " - "), .groups = "drop") %>% pull(rng_F, name = metric)

doSpatPlot(perf_tbl)

```


```{r speed-fig, fig.height=5, fig.width=fig_widths["single"], fig.cap=""}
# Get run times from bench marking results
# compile results after running on cloud
bench_res <- list.files(here::here("analysis/data/derived_data/bench_results"),
                        pattern = "bench_.*.rds",
                        full.names = TRUE) %>%
  purrr::map(readRDS) %>%
  bind_rows() %>%
  tidyr::separate(id, into = c("method", "sampleType", "sampleDens", "agg", "cutblocks_real"),
                  sep = "_",
                  extra = "merge", convert = TRUE)

# Hardy time measured in QGIS with 100m raster
hardy_time <- 2*60+34

ilcp_time <- bench_res %>% 
  filter(method == "ilcp", cutblocks_real == "revelstoke_real",
         resolution == 100) %>% 
  pull(Elapsed_Time_sec) %>% units::set_units("sec") %>%
  units::set_units("hours") %>% round(2) %>% units::drop_units()

mst_time <- bench_res %>% 
  filter(method == "mst", cutblocks_real == "revelstoke_real",
         resolution == 100, sampleDens == 1e-05, sampleType == "regular") %>% 
  pull(Elapsed_Time_sec) %>% units::set_units("sec") %>%
  units::set_units("hours") %>% round(2) %>% units::drop_units()

```

Although these methods project fewer roads than we observe, they represent a substantial improvement over the "cutblocks only" scenario, in which no new roads are added (Figure \@ref(fig:aspat-perf-fig)). That said, these methods are not designed to project the exact locations of new roads, so they (unsurprisingly) do not yield accurate spatial projections of road presence (i.e. the exact locations of roads) (F-Measure: `r perf_tbl_rng["Road presence"]`). Neither do any of the methods provide better information about the exact location of the forestry disturbance footprint than the locations of cutblocks only (F-Measure: `r perf_tbl_rng["Forestry disturbance\nfootprint"]`). All methods provide comparably good projections of the road disturbance footprint (F-Measure: `r perf_tbl_rng["Road disturbance\nfootprint"]`), though higher sampling densities yield fewer false negatives and more false positives (Figure \@ref(fig:spat-perf-fig)). 

Although the MST method performed better than alternatives according to several metrics (Figure \@ref(fig:aspat-perf-fig)), it also requires more memory and more time to compute on large landscapes (Supplement E). All of these methods require construction of a large graph and therefore have substantial memory requirements; graph size depends on the number of pixels in the cost surface where road construction is possible (i.e. not NA), so options such as decreasing raster resolution or constraining the portion of the landscape where roads are plausible can help reduce memory requirements. Memory requirements and computation time can also be reduced by setting a smaller number of landing targets (e.g. only target the centroid of each cutblock). The Hardy method, run in QGIS, was an order of magnitude faster than any of our methods run in R. 

# Discussion

Despite a rapidly growing body of evidence of complex and varied impacts of road networks on wildlife and other values, and increasing use of spatial stochastic models for forecasting impacts of forest disturbance across regions, very few spatial stochastic projections of forest disturbance dynamics have included road network projections, in part because tools suited for this purpose have not been available. Hardy et al. [-@hardy_forest_2019; -@hardy_landis-ii_2023] partially addressed this need with an extension that can be integrated with other components of the Landis-II modelling framework [e.g. @labadie_global_2023]. Our implementations of simple iterative least cost path and minimum spanning tree methods [@lochhead_demo_2018; @lochhead_linking_2022] in the open source R package `roads` [@endicott_roads_2023] provide a complementary and comparable alternative to Hardy's method that can be easily integrated into R workflows and modelling frameworks used for forecasting forest change in Canada and elsewhere [e.g. @barros_empowering_2023; @daniel_state-and-transition_2016].

We evaluated performance of these algorithms in a topographically complex region of British Columbia where we anticipated projection of forest road network patterns would be challenging, using a very simple cost surface model. Thus, we were not surprised to see less accurate projections of road density and presence than in less mountainous regions of eastern Canada with more careful accounting for the cost of water crossings [@hardy_landis-ii_2023]. Water crossing behaviour in Revelstoke could be improved with a more detailed high resolution cost surface, but none of these simple algorithms will project switchbacks on steep slopes that are characteristic of forest roads in mountains. A related fundamental limitation is that none of these algorithms can project road tortuosity within raster cells, so in complex landscapes projections of road density become less accurate as raster cell resolution increases.

Aspatial metrics of overall projection accuracy can be difficult to interpret. To more deeply understand variation in the behaviour of road network projection algorithms we found it helpful to distinguish between performance within cutblocks and outside of them, and to examine spatial variation in discrepancies. Examination of spatial mismatch between observed and projected roads highlighted errors in our input data, and removing mapped cutblocks without observed access roads from our analysis helped resolve the apparently contradictory results. These input data errors are not unique to our study area; there is considerable variation in the consistency and accuracy of available resource road information across Canada and elsewhere [@poley_identifying_2022; @ministry_of_forests_resource_nodate] that users should keep in mind interpreting discrepancies between observed and projected road networks.

Outside cutblocks, we saw very little variation in performance among projection method variants. All were somewhat better than nothing, but the improvement was small because in this landscape new landings were fairly close to existing roads. Outside cutblocks our ILCP algorithm is similar to Hardy's algorithm, so we expect little difference in behaviour where targets are far from existing roads. Within cutblocks, the density of landing points had a much larger impact on performance than the choice of DCLP or MST algorthm. The Hardy algorithm most accurately projected high road density within blocks, but examination of spatial patterns clarified that the projected tortuousity is quite different from observed switchbacks, and may be an artefact of searching for nearest destinations \>200 m away on a 100 m grid. One could increase the density of landing points in the DCLP/MST projections to match the observed high density of roads within cutblocks, but if realistic switchbacks in mountainous terrain is a key goal then none of these algorithms are sufficient.

Simple algorithms can recreate some aspects of observed road networks but not others, and more complex realistic algorithms are more costly to develop and use. Before investing in additional complexity, it is important to recognize that adequacy depends on the goal. For some purposes, projections from relatively crude cost models and simple algorithms may be adequate. For example, models of caribou movement often include distance to roads as a predictor [e.g. @labadie_global_2023], and a combined metric of buffered anthropogenic disturbance best explains variation in boreal caribou demographic rates among ranges [@johnson_science_2020]. In our example landscape, projections of size disturbance footprints (500 m and 1km buffer) and distance to road are reasonably accurate, and for wildlife response models informed by these measures our somewhat crude road projections are likely good enough.

There are many metrics of connectivity and fragmentation [@francis_routledge_2021] we did not consider in this paper. In general, performance will vary among metrics, and it is difficult to determine what is good enough without reference to particular circumstances (i.e. objectives, species, landscapes). The most informative performance metrics will be those most closely linked to outcomes of interest. For example, where the outcome of interest is space use or connectivity projected from more [e.g. @whittington_towns_2022; @labadie_global_2023] or less [e.g. @hughes_comparison_2023; @diniz_landscape_2020] species-specific movement models it may be helpful to test sensitivity of these models to the difference between observed and retrospectively projected roads. When constructing new wildlife response models intended for projection, it may also be helpful to select metrics such as distance to road or buffered disturbance footprint that are more easily projectable [@bodner_bridging_2021]. Rather than adding additional performance metrics to this paper, we have focused our efforts on development of an open source R package [@endicott_roads_2023] and workflows [@endicott_roadpaper_2024] that we hope will help enable users to devise performance tests appropriate to their particular circumstances and goals. We recognize that acquiring data to retrospectively project roads can be challenging, so we also provide output maps [@endicott_2024_assessment_2024] and an example script (analysis/scripts/4_calc_any_metric.R) to enable calculation of alternative performance metrics of interest for our Revelstoke example, along with a data preparation script (analysis/scripts/1_prepareData.R) that could be modified to extract required input data for other areas in British Columbia.

In this paper our focus is tools for integrating forest roads into projections of the cumulative effects of disturbance on wildlife. However, we note there are other possible uses for these road network projection methods. Cost minimizing methods are not suitable for projecting development of seismic lines (Figure \@ref(fig:ftNelson)), but for other circumstances such as mine access where the objective is to minimize the cost of reaching a target location these methods may be applicable. Lochhead et al. [-@lochhead_linking_2022] used the least cost path algorithm to reconstruct the likely history of road network development in a case where harvest dates were known but road construction dates were not. In principle, these algorithms could also be used to link disconnected road segments into a network, but local route finding algorithms [@roussel_vectorial_2023] that do not require construction of large graphs are better suited to this purpose. More obviously, spatial stochastic models are used to project impacts of disturbance on a variety of values other than wildlife [@albrich_simulating_2020; @hof_editorial_2021; @sturtevant_understanding_2021]. It would also be interesting to account for persistent impacts of resource roads on vegetation, productivity and carbon sequestration [@braham_characterization_2023].

```{=html}
<!-- The model will simply build the roads in the least costly locations based on the cost surface, however often in the real world, roads must be planned around ownership and administrative boundaries. In BC, forestry roads are developed by forest licensees under a timber harvesting permit (Government of British Columbia, 2021c). -->

Discuss challenges on large landscapes & solutions...
```
# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
